<div>Using the internal PostgreSQL instance that is embdded in SMA is no longer supported for production environments.&nbsp; If your SMA is using the internal PostgreSQL, you can use the procedure below to migrate SMA to an external PostgreSQL database server.<div><br></div><h2 style="color: rgba(0, 0, 0, 0.87); font-family: MetricHPE; margin-top: 0px; margin-right: 0px; margin-left: 0px; text-transform: none; background-color: transparent; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline;">Step 1: Install the psql and pg_dump commands on a master node</h2><div><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);"><br></span></div><div><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);">On a master node, install the commands with the correct version (9.5 or 9.6) .&nbsp;</span><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);">The command version should comply with the version of the SMA internal PostgreSQL instance.&nbsp;</span><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);">Use the following commands to check the SMA 's internal PostgreSQL version:</span></div><div><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);"><br></span></div><div><span style="background-color: inherit; font-size: 14.6667px; font-variant-ligatures: none; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);"><font color="#000000" face="Calibri, Calibri_MSFontService, sans-serif"><span style="font-weight: 700;"><div>export pgnode_name=`kubectl get pods -n $(kubectl get namespace |grep itsma | cut -f1 -d " ") |grep pgnode | cut -f1 -d " " | tail -1`&nbsp;</div><div><br></div><div>kubectl exec -it $pgnode_name -n&nbsp; $(kubectl get namespace |grep itsma | cut -f1 -d " ")&nbsp; -c suite-pgnode1 -- /usr/bin/psql --version</div></span></font></span></div><div><span style="background-color: inherit; color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-variant-ligatures: no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual; -webkit-text-fill-color: rgb(0, 0, 0); -webkit-text-stroke-color: rgb(0, 0, 0); caret-color: rgb(0, 0, 0);"><br></span></div><div><br></div><div><div class="OutlineElement Ltr  BCX0 SCXO57739962" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow: visible; cursor: text; clear: both; position: relative; direction: ltr;"><p class="Paragraph SCXO57739962 BCX0" xml:lang="EN-US" lang="EN-US" style="font-size: 12px; margin-top: 0px; margin-right: 0px; margin-left: 0px; color: windowtext; font-family: &quot;Segoe UI&quot;, &quot;Segoe UI Web&quot;, Arial, Verdana, sans-serif; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline; background-color: transparent;"><span class="EOP SCXO57739962 BCX0" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; font-size: 11pt; line-height: 18px; font-family: Calibri, Calibri_MSFontService, sans-serif;"><br></span></p><p class="Paragraph SCXO57739962 BCX0" xml:lang="EN-US" lang="EN-US" style="font-size: 12px; margin-top: 0px; margin-right: 0px; margin-left: 0px; color: windowtext; font-family: &quot;Segoe UI&quot;, &quot;Segoe UI Web&quot;, Arial, Verdana, sans-serif; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline; background-color: transparent;"><span class="EOP SCXO57739962 BCX0" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; font-size: 11pt; line-height: 18px; font-family: Calibri, Calibri_MSFontService, sans-serif;">The output should resemble the following:&nbsp;</span></p><p class="Paragraph SCXO57739962 BCX0" xml:lang="EN-US" lang="EN-US" style="font-size: 12px; margin-top: 0px; margin-right: 0px; margin-left: 0px; color: windowtext; font-family: &quot;Segoe UI&quot;, &quot;Segoe UI Web&quot;, Arial, Verdana, sans-serif; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline; background-color: transparent;"><span class="EOP SCXO57739962 BCX0" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; font-size: 11pt; line-height: 18px; font-family: Calibri, Calibri_MSFontService, sans-serif;"></span></p><pre style="padding: 0px; background-color: transparent; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline;"><span class="EOP SCXO57739962 BCX0" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; line-height: 18px;"><font color="#000000" face="Calibri, Calibri_MSFontService, sans-serif"><span style="font-size: 14.6667px;"><span style="font-weight: 700;">psql (PostgreSQL) 9.5.13</span></span></font></span></pre><p class="Paragraph SCXO57739962 BCX0" xml:lang="EN-US" lang="EN-US" style="font-size: 12px; margin-top: 0px; margin-right: 0px; margin-left: 0px; color: windowtext; font-family: &quot;Segoe UI&quot;, &quot;Segoe UI Web&quot;, Arial, Verdana, sans-serif; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline; background-color: transparent;"><br></p><pre style="padding: 0px; background-color: transparent; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline;"><span class="EOP SCXO57739962 BCX0" style="margin: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; line-height: 18px;"><font color="#000000" face="Calibri, Calibri_MSFontService, sans-serif"><span style="font-size: 14.6667px;"><br></span></font></span></pre><h2 style="margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; user-select: text; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; overflow-wrap: break-word; vertical-align: baseline; background-color: transparent;">Step 2: Dump data from the internal PostgreSQL</h2><div>Create a script&nbsp;<span style="color: rgb(120, 35, 12); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 14.6667px; font-style: italic; font-variant-ligatures: none; background-color: transparent;">backupsaw.sh&nbsp;</span><span style="background-color: transparent;">with the followng content, and then run this s</span><span style="background-color: transparent;">cript on the master node to dump data from the internal PostgreSQL.&nbsp;</span><span style="background-color: transparent;">You will see lots of dump files created by the script.&nbsp;&nbsp;</span></div><div><span style="background-color: transparent;"><br></span></div><div><span style="background-color: transparent;">Before running the script, replace&nbsp;</span><span style="letter-spacing: 0.2px; background-color: transparent;">&lt;old_DB_host&gt; with the external access host name of SMA, and replace&nbsp;</span><span style="color: rgb(0, 0, 0); font-family: Calibri, Calibri_MSFontService, sans-serif; font-size: 13.3333px; font-variant-ligatures: none; background-color: transparent;">&lt;new_DB_host&gt;&nbsp;&nbsp;</span><span style="background-color: transparent; letter-spacing: 0.2px;">with the FQDN or IP address of the new PostgreSQL database server.&nbsp;</span></div><div><span style="background-color: transparent; letter-spacing: 0.2px;"><br></span></div><div><div><span style="font-weight: 700;">################# Script Begin ################&nbsp;</span></div><div><span style="font-weight: 700;">#!/bin/bash&nbsp;</span></div><div><span style="font-weight: 700;">#set -x&nbsp;&nbsp;</span></div><div><span style="font-weight: 700;">if [ $# -lt 2 ]; then&nbsp;</span></div><div><span style="font-weight: 700;">&nbsp; &nbsp;echo "Usage: $0 &lt;old_DB_host&gt; &lt;new_DB_host&gt;"&nbsp;</span></div><div><span style="font-weight: 700;">&nbsp; &nbsp;exit 1&nbsp;</span></div><div><span style="font-weight: 700;">fi&nbsp;</span></div><div><span style="font-weight: 700;">olddb=$1&nbsp;</span></div><div><span style="font-weight: 700;">newdb=$2&nbsp;</span></div><div><span style="font-weight: 700;">file_date=`date "+%Y%m%d%H%M%S"`&nbsp;</span></div><div><span style="font-weight: 700;">ns=`kubectl get namespace |grep itsma | cut -f1 -d " "`&nbsp;</span></div><div><span style="font-weight: 700;">if [ -d /tmp/database/old ]; then&nbsp;</span></div><div><span style="font-weight: 700;">&nbsp; mv /tmp/database/old /tmp/database/old.bak.${file_date}&nbsp;</span></div><div><span style="font-weight: 700;">fi&nbsp;</span></div><div><span style="font-weight: 700;">if [ -d /tmp/database/new ]; then&nbsp;</span></div><div><span style="font-weight: 700;">&nbsp; mv /tmp/database/new /tmp/database/new.bak.${file_date}&nbsp;</span></div><div><span style="font-weight: 700;">fi&nbsp;</span></div><div><span style="font-weight: 700;">mkdir -p /tmp/database/old&nbsp;</span></div><div><span style="font-weight: 700;">mkdir -p /tmp/database/new&nbsp;</span></div><div><span style="font-weight: 700;">save_database() {&nbsp;</span></div><div><span style="font-weight: 700;">&nbsp; &nbsp;kubectl get cm database-configmap -n $ns -o yaml &gt; /tmp/database/old/database-configmap.yaml&nbsp;</span></div><div><span style="font-weight: 700;">}&nbsp;</span></div><div><span style="font-weight: 700;">change_database() {&nb