<html>This document describes the process which can be followed to upgrade an older version HCM to 2020.05. The validated older versions of HCM are 2018.11, 2019.02, and 2019.05. Usually, the upgrade process includes upgrading the HCM to each individual incremental of available version, and cannot be upgraded directly to the latest available version. This would mean upgrading HCM 2018.11 to 2020.05 includes upgrading to 2019.02, 2019.05, 2019.08, 2019.11.<br>
<br>
The side-by-side upgrade (parallel instance-based) includes setting up a new version of the HCM 2020.05 version to which the data, configurations, and customizations would be copied to and thereby bring up the new version of HCM in another instance. The old version of HCM can be later decommissioned once the new version is LIVE.
<h2>Pre-requisites</h2>
The important requirement for side-by-side upgrade would be to have new servers, resources for bringing up the new HCM version. It is recommended that the resources and configurations should be the same as the older version of HCM.&nbsp;<br>
<br>
There can be a change in deployment architecture on the new HCM version, this would allow to make an adjustment to the HCM environment. For example, if you were using single master in the old version of HCM, you can deploy 2020.05 as multi-master.
<h3>NFS requirements</h3>
The new HCM instance would need its own NFS repository different from the old HCM version, the old NFS can be decommissioned after the upgrade.

<h3>Database requirements</h3>
In this upgrade, all the HCM databases of the older version are reused, the CDF IDM database is created new. So while installing the new version of HCM, you should create a new database for the CDF IDM which you would continue to use. For the HCM databases, you can use the internal Postgres or create temp databases since you will reconfigure the HCM to point to HCM databases of the older version during the upgrade process.&nbsp;<br>
It is recommended to clone the HCM databases to use with the new HCM version. This way you could still run the older version of HCM until you have the upgrade process completed and validated.
<h3>Virtual IP and Load Balancer configurations</h3>
When the older version of HCM is using a Virtual IP (VIP), we cannot use the same VIP with new HCM version deployment, the new HCM 2020.05 installation will use a new VIP. You have to change the VIP of the HCM 2020.05 to use the existing VIP (from the older version) unless the DNS can be reconfigured to use the same FQDN for new VIP, this is further described in later part of this document.<br>
<br>
When the older version HCM is using an external Load Balancer, then you can deploy the new version of HCM using the temporary load balancer and then reconfigure the external hostname in HCM after the upgrade to use the old Load Balancer. You must also change the load balancer configurations to use the new HCM instances.
<h2>Upgrade Procedure</h2>
The upgrade process assumes that the new HCM 2020.05 is deployed and is accessible. The databases are cloned and is available on to a database server.

<h3>Expose the database port in older version HCM (Only in case of internal Postgres)</h3>
You can skip this step if you are not using internal Postgres for the CDF IDM database.<br>
If you are using the internal Postgres database for the CDF IDM database, then you need to expose the Postgres port on that server. This is required to migrate the IDM database to 2020.05.
<h4>Single node Postgres Service</h4>
Steps to expose ITOM Postgres port outside of kubernetes cluster

<ol>
	<li>Modifiy pg_hba.conf in &lt;db-single-vol&gt;/baseinfra-1.0/postgresql95/ folder. Add below line to the file&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;host &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; md5</li>
	<li>Add below port mapping to the postgres yaml (&lt;core-vol&gt;/suite-install/yamlContent/itom-postgresql-single-svc.yaml). Container section, under image add lines</li>
	<li>&nbsp; &nbsp; &nbsp; &nbsp; image: localhost:5000/hpeswitomsandbox/itom-postgresql:9.5.11-0021<br>
	&nbsp; &nbsp; &nbsp; &nbsp; ports:<br>
	&nbsp; &nbsp; &nbsp; &nbsp; - containerPort: 5432<br>
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hostPort: 5432 &nbsp;</li>
	<li>Once YAML is modified execute below command for the changes to take effect.&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; kubectl apply -f &lt;core-vol&gt;/suite-install/yamlContent/itom-postgresql-single-svc.yaml</li>
</ol>
<br>
&nbsp;</html>