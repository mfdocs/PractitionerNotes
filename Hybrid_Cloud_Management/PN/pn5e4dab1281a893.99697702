<p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;"><b>Manage Linux System Logs affected by Kubernetes</b><span style="box-sizing: border-box; font-weight: bolder;"></span></p><p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;">Occasionally, Linux system logs can become flooded when Kubernetes services are running. These large logs may even de-stabilize the system by consuming available disk space. Although the kubernetes services are related to these conditions, the relationship is not obvious.</p><p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;">Here are the two most common situations that I've seen:</p><ul style="box-sizing: border-box; margin: 0.3em 0px 0px 1.6em; padding: 0px; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;;"><li style="box-sizing: border-box; margin-bottom: 0.1em;"><font size="2">The system has run out of memory, and the kernel is killing processes with OOM errors. These processes are often Ruby or Java processes. If Ruby is consuming resources, then it's almost guaranteed that the fluentd error-loggging system is in an escalating resource-consumption loop (I'll post another short article on how to throttle Ruby). If it's java, it may be UCMDB or OO. 32G of RAM is a lot of memory even today, so there should be enough room for UCMDB and OO to get up and run. Look for another outside process that is causing memory pressure...perhaps security or performance-monitoring tools. The quick way to see the OOM errors is the&nbsp;<i style="box-sizing: border-box;">dmesg</i>&nbsp;command, the log will be in&nbsp;<i style="box-sizing: border-box;">/var/log/messages</i></font></li></ul><ul style="box-sizing: border-box; margin: 0.3em 0px 0px 1.6em; padding: 0px; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;;"><li style="box-sizing: border-box; margin-bottom: 0.1em;"><font size="2">Too many DNS nameservers. Depending which article you read, some people say to stop at 3 nameservers in resolv.conf. We had a customer who had 4 nameservers, and everything was fine &lt;until&gt; kubernetes started up. Then you get more errors in&nbsp;<i style="box-sizing: border-box;">/var/log/messages</i>. More worrisome, the last "bad" DNS servers might not be used in name searches. If you cut back the nameservers in resolv.conf to 3, this problem goes away. (Caveat...these files may be re-written automatically by tools such as Puppet. Then you'll be back where you were....)</font></li></ul><p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;"><br style="box-sizing: border-box;"><b>How to Limit the Message Logging</b></p><p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;">It's certainly best to fix the root causees of OOM or Nameserver errors. If you can live with infrequent errors, here's a way to limit the logging:</p><p style="box-sizing: border-box; margin: 0px 0px 1rem; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px; letter-spacing: normal;">By default, the config file /etc/rsyslogd.conf says to log&nbsp;<i style="box-sizing: border-box;">Info</i>&nbsp;-level messages. We can change this so that only messages of&nbsp;<i style="box-sizing: border-box;">Warn</i>&nbsp;or higher are logged. See bold field below</p><ul style="box-sizing: border-box; margin: 0.3em 0px 0px 1.6em; padding: 0px; color: rgb(33, 37, 41); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 15px;"><li style="box-sizing: border-box; margin-bottom: 0.1em;"><span style="box-sizing: border-box; font-weight: bolder;">.warn</span>;mail.none;authpriv.none;cron.none /var/log/messages</li></ul>