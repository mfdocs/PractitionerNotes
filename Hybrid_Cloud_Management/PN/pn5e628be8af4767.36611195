Micro Focus Hybrid Cloud Management (HCM) allows end users to deploy service instances such as virtual machines, applications, etc. After a service instance has been deployed, HCM displays all defined user actions to end users. Certain enterprises would like to display a subset of user actions to end users depending on state of service instance. Some of the example use cases that enterprises achieve are:<div><br><div><ul><li>When a virtual machine is in powered on status, “Start Server” user action is hidden from end users.</li><li>When a virtual machine is in powered off status, “Stop Server” user action is hidden from end users.<br></li><li>When a web site is up and running, “Start Web Service” user action is hidden from end users.<br></li></ul><div><br></div><div>Follow the steps below to change visibility of certain user actions for a deployed service from end users. In the steps discussed below, when a server is provisioned and powered on during the deployment, the “Start Server” action is hidden from end users.&nbsp; Similar steps can be used to either hide or expose user actions of your choice depending on service instance state.<br></div></div><div><ol><li>Get a list of&nbsp;Operations Orchestration (OO) flows that needs to be modified to change visibility of user actions<ul><li>Login to the HCM Service Management Console.</li><li>In HCM, user actions are configured on resource offerings or service components. User actions can be invoked by subscribers in the HCM Marketplace Portal (MPP) after a subscription has been provisioned. For example, a “Restart Server” user action can be configured on a server service component or on an associated resource offering.<br></li><li>The following are the two categories of OO flows that may need to be modified to change visibility of user actions:&nbsp;<br><ol><li><b>Service lifecycle OO flows</b>: The service lifecycle OO flows are defined in the “LIFECYCLE” tab of the service component and its associated resource offering’s “LIFECYCLE” tab.</li><li><b>User action OO flows</b>: The user action OO flows are defined in the “USER OPERATIONS” tab of the service component and its associated resource offering’s “USER OPERATIONS” tab. These are the user operations (actions) that an end user sees in HCM Marketplace Portal.</li></ol></li><li>Open the service design for the service that requires change in visibility of certain user actions.<br></li><li>Select and view the component that corresponds to service for which visibility of certain user actions have to be changed.<br></li><li>Click “LIFECYCLE” tab. Note down a list of OO flows that needs to be modified. In the sample screenshot below, there are no service lifecycle OO flows that are defined in the service component object.<br><img src="./mediawiki/images/PN/HCM-Visibility-CompLifecycle.png"><br></li><li>Click “USER OPERATIONS” tab. Note down a list of OO flows that needs to be modified. In the sample screenshot below, there are no OO flows that are defined as user operations in the service component object.<br><img src="./mediawiki/images/PN/HCM-Visibility-CompUserOperations.png"><br></li><li>Click “RESOURCE OFFERINGS” tab. Select the “SUN” icon and click “Navigate to Resource Offering”.<br><img src="./mediawiki/images/PN/HCM-Visibility-CompNavRscOff.png"><br></li><li>Click “LIFECYCLE” tab. In the sample screenshot below, “vCenter Deploy VM” OO flow is defined as a service lifecycle OO flow that provisions a VM. Note down a list of OO flows that needs to be modified. The “vCenter Deploy VM” OO flow may need to be modified so that “Start Server” user operation is hidden from end users after deployment of VM.<br><img src="./mediawiki/images/PN/HCM-Visibility-RscOffLifeCycle.png"><br></li><li>Click “USER OPERATIONS” tab. In the sample screenshot below, a list of user operation OO flows that are defined in “Resource Offering” object. These user operation OO flows appear as actions in end user marketplace portal. Note down a list of OO flows that needs to be modified. An example use case may be that after a “Start Server” user operation has been run successfully, “Start Server” user operation should be hidden from end users.<br><img src="./mediawiki/images/PN/HCM-Visibility-RscOffUserActions.png"><br></li></ul></li><li>Modify OO flows to change visibility of user actions depending on service instance state.<ul><li>Launch OO Studio</li><li>Add a new flow input field with the name “actionContainerObjID” to all the identified OO flows in earlier steps. In the sample screenshot below, “actionContainerObjID” flow input has been added to the “vCenter Deploy VM” flow.<br><img src="./mediawiki/images/PN/HCM-Visibility-OOFlowActionContObjInput.png"><br></li><li>This article includes the “UpdateHCMUserActionVisibility” OO flow in XML format. The “UpdateHCMUserActionVisibility” OO flow changes visibility of user actions in HCM Marketplace Portal. The flow gets a list of action names that needs to be hidden, a list of action names that needs to be exposed and the action container object that contains these actions. The flow then updates the action container object with changes to visibility of supplied actions. The action container object can be either a resource subscription or a service component object. When a service instance is deployed in HCM, the following action container objects are created:<br><ul><li>A resource subscription object is created for every resource offering defined on its associated service design.</li><li>A service component object is created for every component on its associated service design.</li></ul></li><li>The “UpdateHCMUserActionVisibility” OO flow can be further enhanced to meet your coding style, implement organization specific requirements, perform additional checks required for your environment, to improve performance, to use as a reference, etc. Use this OO flow as is and it is not supported by Micro Focus.</li><li>Copy contents of the “UpdateHCMUserActionVisibility” flow XML shown below into a text file.<br></li><li>Save the file as “UpdateHCMUserActionVisibility.xml” in an appropriate OO studio workspace project directory of your choice.&nbsp; In the sample screenshot below, the “UpdateHCMUserActionVisibility.xml” file has been saved in the following OO Studio workspace project directory: C:\Users\user01\.oo\Workspace\CSA VMware vCenter Sequenced [18.0.3]\Content\Library\CSA Content Pack\Providers\vCenter\Subflows<br><img src="./mediawiki/images/PN/HCM-Visibility-OOFlowDirLocation.png"><br></li><li>Refresh the project in OO Studio so that the “UpdateHCMUserActionVisibility” flow becomes available for use in OO Studio.<br></li><li>In OO Studio, navigate and click the “UpdateHCMUserActionVisibility” flow. A screenshot of the “UpdateHCMUserActionVisibility” flow is shown below:<br><img src="./mediawiki/images/PN/HCM-Visibility-OOFlowUpdateHCMUserActionFlow.png"><br></li><li>The “UpdateHCMUserActionVisibility” flow has the following inputs: <ul><li><b>actionContainerObjID</b>: Flow expects an object ID from HCM that contains a list of user actions. The action container object can be either a resource subscription object or a service component object. Refer to step 4 for details on how to supply this input from HCM to identified OO flows.</li><li><b>actionListHide</b>: Supply a comma separated list of user action display names to hide from end users. The display names of actions must match (case sensitive) with action names displayed to end users in HCM Marketplace Portal. Examples:<br><ul><li>Stop Server, Suspend Server</li><li>Stop Server</li>
</ul></li><li><b>actionListExpose</b>: Supply a comma separated list of user action display names to hide from end users. The display names of actions must match (case sensitive) with action names displayed to end users in HCM Marketplace Portal. Examples:<br><ul><li>Start Server, Restart Server</li><li>Start Server</li></ul></li><li><b>userIdentifier</b>: userIdentifier is an identifier that is used to authenticate with HCM rest APIs. This userIdentifier value would have been already derived in your existing OO flows such as vCenter Deploy VM, Start Server, etc.<br></li><li><b>trustAllRoots</b>: By default, trusts all root certificates.<br></li><li><b>x509HostnameVerifier</b>: Specifies the way the server hostname must match a domain name in the subject's Common Name (CN) or subjectAltName field of the X.509 certificate. The hostname verification system prevents communication with hosts other than the ones you intended. This is done by checking that the hostname is in the subject alternative name extension of the certificate. This system is designed to ensure that, if an attacker(Man In The Middle) redirects traffic to his machine, the client will not accept the connection. If you set this input to "allow_all", this verification is ignored and you become vulnerable to security attacks. For the value "browser_compatible" the hostname verifier works the same way as Curl and Firefox. The hostname must match either the first CN, or any of the subject-alts. A wildcard can occur in the CN, and in any of the subject-alts. The only difference between "browser_compatible" and "strict" is that a wildcard (such as "*.foo.com") with "browser_compatible" matches all subdomains, including "a.b.foo.com". From the security perspective, to provide protection against possible Man-In-The-Middle attacks, we strongly recommend to use "strict" option. By default, uses “allow_all” to allow all types of hostname verification. Following are the valid values: strict,browser_compatible,allow_all<br></li><li><b>trustKeystore</b>: Uses value as defined in the following system property on OO Central: OO_TRUST_KEYSTORE_PATH. Do not change this value.<br></li><li><b>trustPassword</b>: Uses value as defined in the following system account in OO central: OO_TRUST_PASSWORD. Do not change this value.<br></li></ul></li><li>Insert “UpdateHCMUserActionVisibility” flow as a subflow in all of the identified flows that need to change user action visibility. Supply values for the inputs to the “UpdateHCMUserActionVisibility” subflow. In the sample screenshot below, the “UpdateHCMUserActionVisibility” flow has been inserted as a step/subflow in the “vCenter Deploy VM” OO flow. The “UpdateHCMUserActionVisibility” step is inserted after provision of VM step.<img src="./mediawiki/images/PN/HCM-Visibility-DeployVMFlowWithUpdateVisibility.png"><br></li></ul></li><li>In OO Studio, create a new content pack using updated OO flows. Upload new content pack to OO Central.<br></li><li>Map HCM action container object ID to the “actionContainerObjID” flow input field of OO flows.<br><ul><li>Login to the HCM Service Management console with admin privileges.</li><li>Navigate to the following locations: Resource Offering Lifecycle, Resource Offering User Operations, Service Component Lifecycle and Service Component User Operations.<br></li><li>Edit actions to define flow mappings for the identified OO flows.<br><img src="./mediawiki/images/PN/HCM-Visibility-EditActions.png"><br></li><li>For the OO flows that need to change visibility of user actions, map the appropriate HCM tokens depending on action container object. If action container object is a resource offering/resource subscription, then map “Resource Subscription ID” token to the OO flow input “actionContainerObjID”.&nbsp; If action container object is a service component, then map “Service Component ID” token to the OO flow input “actionContainerObjID”. In the sample screenshot below, the “vCenter Deploy VM” flow input “actionContainerObjID” has been mapped to the HCM token RSC_SUBSCRIPTION_ID (Resource subscription ID).<br><img src="./mediawiki/images/PN/HCM-Visibility-EditActionsTokens.png"><br></li></ul></li><li>Deploy new service in HCM Marketplace Portal. Test and fix any flow input and/or mapping issues.<br></li><li>The following screenshot shows all available user actions on a deployed service that was deployed without incorporating business logic to change visibility of user actions:<br></li><li>The following screenshot shows all available user actions on a deployed service after making changes to the “vCenter Deploy VM” flow to hide “Start Server” user action.<br></li></ol></div></div>