<html><p>While Data Protector is usually using Recovery Manager (RMAN) to perform efficient backups and restores of Oracle Databases the process can be reversed to match the needs of more advanced Oracle DBAs. This means RMAN can be used to control Data Protector to perform backups, restores or validate backups. Data Protector will act as the media manager software leveraging the Media Management Layer (MML).</p>

<h2>Prerequsite</h2>

<p>The Oracle integration needs to be configured for the database in Data Protector and at least one backup spec must be configured to use an available backup device. It is recommended to test the backup spec. Please see the available documentation for configuration details.</p>

<h2>Sample RMAN Scripts</h2>

<p>The following scripts use <b>sample values</b> that must be changed according to the customer environment.</p>

<div class="Admonition_Note">Oracle Database Server: <code>ORASRV</code><br>
Oracle SID: <code>SID</code><br>
Oracle User: <code>sys</code><br>
Oracle Password: <code>password</code><br>
Oracle Backup Spec: <code>ORASRV_SID_Full</code><br>
Oracle SBT library:&nbsp;<code>C:/PROGRA~1/OmniBack/bin/orasbt.dll</code></div>

<p><span style="background-color: transparent;">The path to the Oracle SBT library is different on Linux</span><span style="background-color: transparent;">&nbsp;</span><span style="background-color: transparent;">and UNIX. Oracle on a 64 bit Linux is using&nbsp;</span><span style="background-color: transparent;"><code>/opt/omni/lib/libob2oracle8_64bit.so</code>.&nbsp;</span><span style="background-color: transparent;">Please refer to the Data Protector session report after running a test backup.</span></p>

<div style="">
<h3>Backup the Oracle Controlfile</h3>

<pre>connect target sys/password@SID
run {
allocate channel 'dev_0' type 'sbt_tape'
 parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
 ENV=(OB2BARTYPE=Oracle8,OB2APPNAME=SID,OB2BARLIST=ORASRV_SID_Full)';
backup
 format 'ORASRV_SID_Full&lt;SID_%s:%t:%p&gt;.dbf'
 current controlfile;
}
</pre>

<h3 style="text-transform: none;">Restore the Oracle Controlfile</h3>

<pre>connect target sys/password@SID
run {
allocate channel 'dev_0' type 'sbt_tape'
 parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
 ENV=(OB2BARTYPE=Oracle8,OB2APPNAME=SID,OB2BARLIST=ORASRV_SID_Full)';
restore controlfile validate;
}
</pre>

<h3 style="text-transform: none;">Validate the Backup of the Oracle Controlfile</h3>

<pre>connect target sys/password@SID
run {
allocate channel 'dev_0' type 'sbt_tape'
 parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
 ENV=(OB2BARTYPE=Oracle8,OB2APPNAME=SID,OB2BARLIST=ORASRV_SID_Full)';
restore controlfile to 'C:\Temp\control_file';
}
</pre>

<h3 style="text-transform: none;">Perform a Backup Crosscheck</h3>

<pre>connect target sys/password@SID
run {
allocate channel 'dev_0' type 'sbt_tape'
 parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
 ENV=(OB2BARTYPE=Oracle8,OB2APPNAME=SID,OB2BARLIST=ORASRV_SID_Full)';
crosscheck backup;
crosscheck archivelog all;
}
</pre>

<h3 style="text-transform: none;">Delete Expired Backups</h3>

<pre>connect target sys/password@SID
run {
allocate channel 'dev_0' type 'sbt_tape'
 parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
 ENV=(OB2BARTYPE=Oracle8,OB2APPNAME=SID,OB2BARLIST=ORASRV_SID_Full)';
delete noprompt expired backup;
}
</pre>

<h2>Execute Scripts from RMAN</h2>

<div>There are several ways to execute RMAN scripts. While you could simply paste the script into a RMAN session you could also save the script (e.g. validate.txt) to a file and run it using <code>@validate.txt</code>.</div>

<pre>C:\&gt;rman

Recovery Manager: Release 12.2.0.1.0 - Production on Mon Dec 16 18:08:31 2019

Copyright (c) 1982, 2017, Oracle and/or its affiliates.  All rights reserved.

RMAN&gt; @C:\RMAN\validate.txt

RMAN&gt; connect target *
connected to target database: DCM (DBID=1582047051)

RMAN&gt; run {
2&gt; allocate channel 'dev_0' type 'sbt_tape'
3&gt;  parms 'SBT_LIBRARY=C:/PROGRA~1/OmniBack/bin/orasbt.dll
[...]</pre>

<p>&nbsp;</p>
</div>
</html>