<div><br></div><div>Nutanix is a hyper converged appliance which supports various virtualizations like VMware and Hyper-V.</div><div>Nutanix has its own hypervisor called Acropolis Hyper-Visor (AHV) which offers integrated virtualization.</div><div>Micro focus Data Protector has developed a script-based solution which enables administrators to perform backup and restore of AHV VMs.</div><div>Nutanix AHV integration with Data Protector</div><div>Data Protector uses scripts to perform backup and restore of Nutanix AHV VMs. These scripts are used as pre/post- execution scripts in the filesystem backup specification. These scripts use the Nutanix REST APIs to carry out the VM management operations (snapshot, backup, restore, etc).</div><div>During the backup, the pre-exec script creates a live external snapshot of the AHV VMs and mounts it on the backup proxy. These snapshots and mount points can then be backed up with a filesystem backup or Disk Image backup.</div><div>• If backup is taken at file level, then individual files can be restored on the backup proxy.</div><div>• If backup is taken as disk-image, then only full VM can be restored using the restore scripts.</div><div>During the backup, post-exec scripts are used for cleanup of snapshot and temporary files. During the image level restore, the post-exec scripts are used for restoring the raw data.</div><div>Important</div><div>By using these scripts to perform backup and restore of VMs in Nutanix infrastructure, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using these scripts, you understand and agree to assume all associated risks and hold Micro Focus harmless for the same.</div><div>Micro Focus encourages you to add relevant protection measures to protect against risks associated with user information, which is not provided by Micro Focus. By not implementing relevant protection measures, you are exposing the system to increased security risks. You understand and agree to assume all associated risks and hold Micro Focus harmless for the same. It remains at all times your sole responsibility to assess your own regulatory and business requirements. Micro Focus does not represent or warrant that its products comply with any specific legal or regulatory standards applicable to you in conducting your business.</div><div>4</div><div><br></div><h5>Prerequisites</h5><div>The following prerequisites apply:</div><div>• Ensure that the Data Protector Cell Manager is of version 2019.05 or higher versions.</div><div>• Ensure that the below RPM are installed on Linux backup proxy:</div><div>o Jq</div><div>o ntfs-3g</div><div>• Ensure to create a file system mount point in backup proxy. The mount point is used to store the configuration data during the backup and restore. This mount point should be a filesystem directory on Linux mount proxy host with appropriate permission. This mount point needs to be mentioned against the $CONF variable, referred in Nutanix_config.sh sctipt.</div><div>• Ensure that the Nutanix_config.sh script is edited before running the backup.</div><div>• Ensure that the backup proxy is imported to the Cell Manager.</div><div>• Ensure to delete all snapshots before taking a backup. This rule does not apply to the backup proxy as it will not be backed up by Data Protector.</div><div><br></div><h5>Limitations</h5><div>The following limitations apply:</div><div>• Only Linux backup proxy is supported. It has to be part of the same AHV infrastructure.</div><div>• In case of image level backup, the entire disk gets backed up as a raw image. In case of file level backup, all the files in the filesystem get backed up.</div><div>• If the Data Protector Cell Manager, backup proxy, and Data Protector GUI are a part of the same infrastructure, then both do not get backed up by Data Protector.</div><div>• Only single VM backup and restore is supported at image level.</div><div>• If VM name includes the word “keep”, that VM will not get backed up.</div><div>Integrate and Configure Data Protector with AHV</div><div>To integrate and configure Data Protector with AHV, perform the following steps:</div><div>1. Download the AHV scripts zip package from ITOM Marketplace. Contact Customer Support if you have any issues.</div><div>2. Log into AHV Backup proxy host and extract the downloaded scripts in the /opt/omni/lbin path. The following scripts are extracted for file level and image level backup and restore:</div><div>o Nutanix_config.sh</div><div>5</div><div>o Nutanix_Pre_File_Backup.sh</div><div>o Nutanix_Post_Backup_Cleanup.sh</div><div>o Nutanix_Pre_Image_Backup.sh</div><div>o Nutanix_post_conf_Restore.sh</div><div>o Nutanix_post_VM_Restore.sh</div><div>3. Change the file permission to 500 on all Nutanix_Pre_*, Nutanix_post_* AHV scripts.</div><div>For example: cd /opt/omni/lbin</div><div>chmod 500 Nutanix_Pre_File_Backup.sh</div><div>4. Change the file permission to 700 for Nutanix_config.sh</div><div>For example: cd /opt/omni/lbin</div><div>chmod 700 Nutanix_config.sh</div><div>5. Edit the Nutanix_config.sh file using any file editors.</div><div>Provide the variable inputs for AHV environment backup.</div><div>6. Create the VM list file Nutanix_VM_List under the path /opt/omni/lbin. This file must contain a list of all the VMs to be backed up. Each VM name must be on a new line.</div><div>The Data Protector and Nutanix AHV integration supports the following configurations:</div><div>• AHV VM file level backup</div><div>• AHV VM file level restore</div><div>• AHV VM image level backup</div><div>• AHV VM image level VM restore</div><div>AHV VM file level backup</div><div>AHV VM file level backup uses Data Protector’s filesystem backup functionality to backup VMs. Complete the following steps to perform a file level backup:</div><div>1. Log into the Data Protector GUI host and connect to Cell Manager.</div><div>2. In the Client context, import the Linux backup proxy host into the Cell Manager.</div><div>3. In the Device and Media context, create a backup device to store the backup data (file or VM image).</div><div>4. Create a backup specification nutanix_backup1.</div><div>Make sure to select the mount point created earlier for backup in the backup specification. Also set $CONF in Nutanix_config.sh to this mount point.</div><div>a. In the Options tab, click Advanced under Backup Specification Options.</div><div>6</div><div>b. Specify Nutanix_Pre_File_Backup.sh in the Pre-exec script field.</div><div>c. Specify the Nutanix host in the On client field.</div><div>d. Save and schedule this backup specification.</div><div>6. Create a second backup specification nutanix_backup2.</div><div>Make sure to select the mount point created earlier for backup in the backup specification. Also set $CONF in Nutanix_config.sh to this mount point.</div><div>Set $NUTANIX_DATALIST variable in Nutanix_config.sh to the name of the second backup specification.</div><div>For example: $NUTANIX_DATALIST= nutanix_backup2.</div><div>a. In the Options tab, click Advanced under Backup Specification Options.</div><div>b. Specify Nutanix_Post_Backup_Cleanup.sh in the Post-exec field.</div><div>Do not schedule this backup specification as this backup runs through the pre-exec script configured in first backup specification.</div><div>c. Click OK.</div><div>AHV VM file level restore</div><div>Complete the following steps to Restore VMs:</div><div>1. In the context list, click Restore.</div><div>2. File level restore can be done in multiple ways:</div><div>a. In the Scoping Pane, expand Restore Sessions and select the appropriate session. In the results area, select the files from the appropriate disk to be restored.</div><div>b. In the Scoping Pane, expand Restore Objects and select Filesystem. In the results area, select the host and appropriate disk to select the files to be restored.</div><div>AHV VM image level backup</div><div>AHV image level backup uses Data Protector’s raw disk backup functionality to backup VMs. Complete the following steps to perform an image level backup:</div><div>1. Log into the Data Protector GUI host and connect to Cell Manager.</div><div>2. In the Client context, import the Linux backup proxy host into the Cell Manager.</div><div>3. In the Device and Media context, create a backup device to store the backup data (file or VM image).</div><div>4. Create a backup specification nutanix_backup1.</div><div>Make sure to select the mount point created earlier for backup in the backup specification. Also set $CONF in Nutanix_config.sh to this mount point.</div><div>7</div><div>a. In the Options tab, click Advanced under Backup Specification Options.</div><div>b. Specify Nutanix_Pre_Image_Backup.sh in the Pre-exec script field.</div><div>c. Specify the Nutanix host in the On client field.</div><div>d. Save and schedule the backup specification.</div><div>5. Create a second backup specification nutanix_backup2.</div><div>Make sure to select the mount point created earlier for backup in the backup specification. Also set $CONF in Nutanix_config.sh to this mount point.</div><div>Set $NUTANIX_DATALIST variable in Nutanix_config.sh to the name of the second backup specification.</div><div>For example: $NUTANIX_DATALIST= nutanix_backup2.</div><div>a. In the Options tab, click Advanced under Backup Specification Options.</div><div>b. Specify Nutanix_Post_Backup_Cleanup.sh in the Post-exec field.</div><div>Do not schedule this backup specification as this backup runs through the pre-exec script configured in first backup specification.</div><div>c. Click OK.</div><div>AHV VM image level restore</div><div>Complete the following steps to perform single VM restore:</div><div>1. Launch Data Protector and select Restore context.</div><div>2. Select the disk image backup you want to restore.</div><div>Single VM restore is a multiple step process. Start with configuration restore and then actual VM image restore. Complete the following steps:</div><div>1. Restore configuration data to the backup proxy $CONF directory:</div><div>a. In the Context list, select Restore. In the Scoping Pane, expand Restore Sessions. Select the session and mount point provided in $CONF.</div><div>b. In the Source tab, select the VM directory to restore the configuration data to backup proxy.</div><div>c. In the Options tab, specify Nutanix_post_conf_Restore.sh in the Post-exec script field.</div><div>d. Perform the restore and make sure the restored VM configuration data is available in $CONF mount point on backup proxy.</div><div>2. Restore Disk Images of VMs on backup proxy:</div><div>8</div><div>a. In the Restore Context, expand Restore Session and select the appropriate backup session and disk image of single VM for which the configuration data is already restored.</div><div>b. In the Options tab, specify Nutanix_post_VM_Restore.sh in the Post-exec script field.</div><div>This post-exec script renames the restored VM to $VM_keep_$DATE and then creates a new VM. The disks are attached to the new VM and network configuration is updated.</div><div>c. Click Restore.</div><div>Cleanup</div><div>1. Go to Nutanix AHV web console and manually delete $VM_keep_$DATE post verification of the restored VM.</div><div>2. Use this script to manually clean up the backup proxy:</div><div>/opt/omni/lbin/Nutanix_Post_Backup_Cleanup.sh</div><div>References</div><div>For more information on creating backup devices and backup specifications, see Data Protector Documentation at https://docs.microfocus.com/?DP.</div>