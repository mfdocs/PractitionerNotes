<div class="metric f18 ng-star-inserted" id="mwpage" style="line-height: 27px;"><div class="mw-parser-output"><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">This topic provides information on Red Hat KVM host integration with Data Protector and backup/restore on online virtual machines (VMs) in Red Hat KVM host.</p><h2><span class="mw-headline" id="Red_Hat_Kernel-based_Virtual_Machine">Red Hat Kernel-based Virtual Machine</span></h2><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">Red Hat Kernel-based Virtual Machine (KVM) is an open source virtualization technology built into Linux. Specifically, KVM lets you turn Linux into a hypervisor that allows a host machine to run multiple, isolated virtual environments called guests or virtual machines (VMs).</p><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">KVM converts Linux into a type-1 (bare-metal) hypervisor. All hypervisors need some operating system-level components such as a memory manager, process scheduler, input/output (I/O) stack, device drivers, security manager, a network stack, and more—to run VMs. KVM has all these components because it’s part of the Linux kernel. Every VM is implemented as a regular Linux process, scheduled by the standard Linux scheduler, with dedicated virtual hardware like a network card, graphics adapter, CPU(s), memory, and disks.</p><h2><span class="mw-headline" id="Data_Protector_and_Red_Hat_KVM_integration">Data Protector and Red Hat KVM integration</span></h2><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">Data Protector uses scripts to backup the live, running, or online VMs in a Red Hat KVM host. The scripts are saved in the pre-exec and post-exec areas of the backup specification. The pre-exec script creates a live external snapshot of the VM and saves it in the local/SAN storage mount point configured for&nbsp;<code>$BACKUPDIR</code>&nbsp;variable in the backup script. This script uses all the Red Hat KVM features and functionality to carry out the operations.</p><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">The restoration of the VMs is based on the post-exec scripts for restore. In Data Protector, select the backed up directory (as specified in the&nbsp;<code>$BACKUPDIR</code>&nbsp;variable) for choosing the VMs for restore. These selected VMs are copied to restored path&nbsp;<code>$RESTORED_PATH</code>&nbsp;variable as defined in the restore script KVM_snap_Restore.sh. Select the VM directory from the&nbsp;<code>$BACKUPDIR</code>&nbsp;variable in the backup script and choose a restore path&nbsp;<code>$RESTORED_PATH</code>&nbsp;variable defined in the restore script.</p><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;"><a class="image" title="DP KVMRedHatIntegration.png"><img alt="DP KVMRedHatIntegration.png" src="https://docs.microfocus.com/mediawiki/images/7/73/DP_KVMRedHatIntegration.png" width="1245" height="638" data-file-width="1245" data-file-height="638"></a></p><h3><span class="mw-headline" id="Use_cases">Use cases</span></h3><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">The Data Protector and Red Hat KVM integration support the following use cases:</p><ul><li>Single VM backup and restore</li><li>Multi VM backup and single VM restore</li><li>Multi VM backup and multi VM restore</li></ul><h3><span class="mw-headline" id="Supported_disk_types">Supported disk types</span></h3><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">There is no limit to disk types supported. Red Hat KVM scripts uses the&nbsp;<span style="font-weight: 700;">virsh</span>&nbsp;utility to create a snapshot.</p><h2><span class="mw-headline" id="Prerequisites">Prerequisites</span></h2><ul><li>Ensure the KVM host is imported on the Cell Manager.</li><li>Ensure that the utility packages&nbsp;<span style="font-weight: 700;">virt-manager 1.4.3</span>&nbsp;or later versions and&nbsp;<span style="font-weight: 700;">virsh 3.9.0</span>&nbsp;or later versions are installed.</li><li>Ensure there is enough free storage (SAN or local filesystem) for backing up all the online VMs in Red Hat KVM host.</li></ul><h3><span class="mw-headline" id="Storage_requirements">Storage requirements</span></h3><ol><li>Mount your backup filesystem as&nbsp;<span style="font-weight: 700;">/kvmbackup</span>.</li><li>Create a SAN or local filesystem with a storage that can backup all the online VMs in Red Hat KVM host for any given backup session. For example, consider three online VMs in a Red Hat KVM host with sizes 10 GB, 20 GB, and 30 GB.<ul><li>If you are backing up all three VMs, ensure that the /kvmbackup directory has a free storage of minimum 75-80 GB.</li><li>If you are backing up VMs individually, ensure that the /kvmbackup directory has a free storage more than the VM with the largest size.</li><li>The storage mentioned is only an indicated storage space. Actual storage space may vary depending on your environment.</li></ul></li><li>Consider also the growth in your Red Hat KVM environment while planning your storage.</li></ol><h2><span class="mw-headline" id="Install_Red_Hat_KVM">Install Red Hat KVM</span></h2><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">Install KVM using the&nbsp;<span style="font-weight: 700;">qemu-kvm-rhev</span>&nbsp;package to avail the online VM snapshot capability.</p><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;"><br></p><h2><span class="mw-headline" id="Backup_online_VMs_in_Red_Hat_KVM_host">Backup online VMs in Red Hat KVM host</span></h2><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">To integrate Red Hat KVM host with Data Protector and then to backup online VMs in it, complete the following steps:</p><ol><li>Download the KVM scripts zip package from&nbsp;<a target="1" rel="nofollow" class="external text" href="https://marketplace.microfocus.com/itom">ITOM Marketplace</a>. Contact&nbsp;<a target="1" rel="nofollow" class="external text" href="http://softwaresupport.softwaregrp.com/">Customer Support</a>&nbsp;if you have any issues.</li><li>Log into Red Hat KVM host and extract the downloaded scripts in the&nbsp;<span style="font-weight: 700;">/opt/omni/lbin</span>&nbsp;path. The following scripts are extracted:<ul><li>KVM_snap_backup.sh</li><li>KVM_cleanup_post_backup.sh</li><li>KVM_snap_Restore.sh</li></ul></li><li>Change the file permission on the scripts to read, write and execute:<ul><li>chmod 755 KVM_snap_backup.sh</li><li>chmod 755 KVM_cleanup_post_backup.sh</li><li>chmod 755 KVM_snap_Restore.sh</li></ul></li><li>Edit the KVM_snap_backup.sh script file. Example:&nbsp;<span style="font-weight: 700;">vi KVM_snap_backup.sh</span>.<ul><li>If you do not wish to backup all the online VMs, edit the&nbsp;<span style="font-weight: 700;">$VMS</span>&nbsp;variable to manually input the VMs to be backed up. By default, all the online VMs are backed up.</li><li>Define your SAN/local storage filesystem mount point. Update the&nbsp;<span style="font-weight: 700;">$BACKUPDIR</span>&nbsp;variable with the storage mount point path.<br>Example: BACKUPDIR=/kvmbackup/$VM/$(date +'%d-%m-%Y%H%M%S')</li></ul></li><li>Edit the KVM_post_cleanup_backup.sh script file. Example:&nbsp;<span style="font-weight: 700;">vi KVM_post_cleanup_backup.sh</span>.<br>Update the&nbsp;<span style="font-weight: 700;">$BACKUPDIR</span>&nbsp;variable with the storage mount point path.<br>Example: BACKUPDIR=/kvmbackup.</li><li>Log into the Cell Manager.</li><li>Import Red Hat KVM host into the Cell Manager, if not imported already.</li><li>Create a tape or disk device on the Cell Manager to store the Red Hat KVM host backup. For information on creating a tape or disk device, see Data Protector documentation at&nbsp;<a target="1" rel="nofollow" class="external free" href="https://docs.microfocus.com/?DP">https://docs.microfocus.com/?DP</a>.</li><li>Launch Data Protector and go to&nbsp;<span style="font-weight: 700;">Backup</span>&nbsp;context.</li><li>Select&nbsp;<span style="font-weight: 700;">Filesystem</span>&nbsp;in the left navigation and go to&nbsp;<span style="font-weight: 700;">Options</span>&nbsp;tab.</li><li>Enter a description in the Description field in&nbsp;<span style="font-weight: 700;">Backup Specification Options</span>&nbsp;area.</li><li>Click&nbsp;<span style="font-weight: 700;">Advanced</span>&nbsp;in&nbsp;<span style="font-weight: 700;">Backup Specification Options</span>&nbsp;area. Specify the following:<ul><li>Pre-exec area:<ul><li>Specify&nbsp;<span style="font-weight: 700;">KVM_snap_backup.sh</span>&nbsp;in&nbsp;<span style="font-weight: 700;">Pre-exec script</span>&nbsp;field (browse and select the script file from the&nbsp;<code>/opt/omni/lbin</code>&nbsp;path).</li><li>Specify the Red Hat KVM host name in the&nbsp;<span style="font-weight: 700;">On client</span>&nbsp;field.</li></ul></li><li>Post-exec area:<ul><li>Specify&nbsp;<span style="font-weight: 700;">Post_backup_cleanup_KVMsnapshot.sh</span>&nbsp;in the&nbsp;<span style="font-weight: 700;">Pre-exec script</span>&nbsp;field (browse and select the script file from the&nbsp;<code>/opt/omni/lbin</code>&nbsp;path).</li><li>Specify Red Hat KVM host name in the&nbsp;<span style="font-weight: 700;">On client</span>&nbsp;field.</li></ul></li></ul></li><li>Click&nbsp;<span style="font-weight: 700;">OK</span>&nbsp;in the Backup Option window.</li><li>Select the default protection period for all backed up files and directories in the&nbsp;<span style="font-weight: 700;">Filesystem Options</span>&nbsp;area.</li><li>Select the default protection period for all backed up disk images in the&nbsp;<span style="font-weight: 700;">Disk Image Options</span>&nbsp;area.</li><li>Click&nbsp;<span style="font-weight: 700;">Apply</span>&nbsp;in the Backup context to save the backup specification.</li><li>Start the full backup and monitor the progress.</li></ol><h2><span class="mw-headline" id="Restore_VMs">Restore VMs</span></h2><p style="margin-right: 0px; margin-bottom: 12px; margin-left: 0px;">To restore a backed up VM, complete the following steps:</p><ol><li>Launch Data Protector and select&nbsp;<span style="font-weight: 700;">Restore</span>&nbsp;context.</li><li>Select the Red Hat KVM host backup session from the&nbsp;<span style="font-weight: 700;">Filesystem</span>&nbsp;tree in the left navigation.<br>OR, select the object that you wish to restore. Object hierarchy is&nbsp;<span style="font-weight: 700;">/kvmbackup/&lt;VM_Name&gt;/&lt;Date&amp;Time&gt;/</span>.</li><li>Select the VM and underlying files to restore the VM.</li><li>Select the default restore location in the&nbsp;<span style="font-weight: 700;">Destination</span>&nbsp;tab. If the $RESTORE_PATH value is different than $BACKUPDIR value, then select the $RESTORE_PATH value in Destination tab.</li><li>Go to&nbsp;<span style="font-weight: 700;">Options</span>&nbsp;tab and click&nbsp;<span style="font-weight: 700;">Advanced</span>.</li><li>Specify&nbsp;<span style="font-weight: 700;">KVM_snap_Restore.sh</span>&nbsp;in Post-exec script field (browse and the script file from the&nbsp;<span style="font-weight: 700;">/opt/omni/lbin</span>&nbsp;path).</li><li>Click&nbsp;<span style="font-weight: 700;">Restore</span>.</li><li>Check the VM status in Red Hat KVM host after the restore is complete.</li></ol></div></div><app-pgfeedback _nghost-c38="" class="ng-star-inserted" style="font-family: Roboto, &quot;Helvetica Neue&quot;, sans-serif; font-size: 14px;"><div _ngcontent-c38="" style="padding: 23.3611px 0px 0px;"></div></app-pgfeedback>