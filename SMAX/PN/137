





<!--StartFragment-->

<div style="direction:ltr;border-width:100%">

<div style="direction:ltr;margin-top:0in;margin-left:0in;width:7.7715in">

<div style="direction:ltr;margin-top:0in;margin-left:0in;width:7.7715in">

<p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">After SMA is installed, you may need to switch SMA to a new NFS
server for some reasons. For example,<span style="mso-spacerun:yes">&nbsp;
</span>the existing NFS server requires maintenance, is not stable, or has
performance issues.<span style="mso-spacerun:yes">&nbsp; </span></p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">The following describes the process of switching SMA from one NFS
server to another. </p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black"><span style="font-weight:bold">Note: during this process, SMA will
experience downtime. For this reason, perform this operation only in a
scheduled<span style="mso-spacerun:yes">&nbsp; </span>maintenance window.</span></p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:MetricHPE;font-size:16.0pt;
color:black"><span style="font-weight:bold">Part I: CDF</span></p><p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:black">Following the document below to change the NFS server for CDF</p><p style="margin:0in;margin-left:.375in"><a href="https://docs.microfocus.com/itom/SMAX:2019.11/changePersistentVolumes"><span style="font-family:Calibri;font-size:11.25pt" lang="en-US">https://docs.microfocus.com/itom/SMAX:2019.11/changePersistentVolumes</span></a><span style="font-family:Calibri;font-size:11.0pt;color:black" lang="zh-CN">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:MetricHPE;font-size:16.0pt;
color:black"><span style="font-weight:bold">Part II: SMA</span></p><ol type="1" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt;
 font-weight:normal;font-style:normal">
 <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;
     color:black"><span style="font-family:Calibri;font-size:11.0pt;font-weight:
     normal;font-style:normal;font-family:Calibri;font-size:11.0pt">Stop SMA
     first.</span></li>
</ol><ol type="1" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:13.5pt;
 font-weight:normal;font-style:normal">
 <li value="2" style="margin-top:0;margin-bottom:0;vertical-align:middle;
     color:black"><span style="font-family:MetricHPE;font-size:13.5pt;
     font-weight:normal;font-style:normal;font-family:MetricHPE;font-size:13.5pt">Run
     the following script on one master node.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:MetricHPE;font-size:13.5pt">Check that all PVs are set
     up correctly:<span style="mso-spacerun:yes">&nbsp;&nbsp; </span>//Kathy: add
     command? </span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:MetricHPE;font-size:13.5pt;color:black" lang="en-US">and
     then restart the Kubernetes cluster as described in </span><a href="https://docs.microfocus.com/itom/SMAX:2019.11/RestartSMASuite"><span style="font-family:Calibri;font-size:11.0pt" lang="zh-CN">https://docs.microfocus.com/itom/SMAX:2019.11/RestartSMASuite</span></a><span style="font-family:Calibri;font-size:11.0pt;color:black" lang="zh-CN">.</span></li>
</ol><p style="margin:0in;margin-left:.375in;font-family:MetricHPE;font-size:13.5pt;
color:black">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:MetricHPE;font-size:13.5pt;
color:black">The script will perform the following operations:</p><ul type="disc" style="margin-left:.75in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt" lang="en-US">Back up the
     current PV for the Kubernetes cluster in the /tmp/</span><span style="font-style:italic;font-family:Calibri;font-size:11.0pt" lang="zh-CN">Persistentvolume/</span><span style="font-family:Calibri;font-size:11.0pt" lang="zh-CN">pv/old folder</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt" lang="en-US">Create a new PV
     yaml file in the new folder /tmp/</span><span style="font-style:italic;
     font-family:Calibri;font-size:11.0pt" lang="zh-CN">Persistentvolume/</span><span style="font-family:Calibri;font-size:11.0pt" lang="zh-CN">pv/new</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt" lang="en-US">Back up the
     current PVC for the Kubernetes cluster in the /tmp/</span><span style="font-style:italic;font-family:Calibri;font-size:11.0pt" lang="zh-CN">Persistentvolume/</span><span style="font-family:Calibri;font-size:11.0pt" lang="zh-CN">pvc/old folder</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt" lang="en-US">Create a new PVC
     yaml file in the new folder /tmp/</span><span style="font-style:italic;
     font-family:Calibri;font-size:11.0pt" lang="zh-CN">Persistentvolume/</span><span style="font-family:Calibri;font-size:11.0pt" lang="zh-CN">pvc/new</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt">Create a new PVC with the
     updated PVC yaml.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:black"><span style="font-family:Calibri;font-size:11.0pt">Create a new PV with the
     updated PV yaml</span></li>
</ul><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:11.0pt;
color:black">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-size:11.0pt;color:black"><span style="font-style:italic;font-family:calibri" lang="en-US">################
Script Begin&nbsp;</span><span style="font-style:italic;font-family:Calibri" lang="zh-CN">################&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;color:black"><span style="font-size:11.0pt" lang="en-US">&nbsp;</span><span style="font-style:italic;
font-size:13.5pt" lang="zh-CN">#!/bin/bash</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># This script is used to change PV
IP address (keep path) for an installed SMAX&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># This script will:&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Backup current PV for
Kubernetes cluster under /tmp/Persistentvolume/pv/old folder</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Create new PV yaml file in the
new folder /tmp/Persistentvolume/pv/new</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Backup current PVC for
Kubernetes cluster under /tmp/Persistentvolume/pvc/old folder</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Create new PVC yaml file in
the new folder /tmp/Persistentvolume/pvc/new</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Create new PVC with updated
PVC yaml.</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic"># * Create new PV with updated PV
yaml.</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">#set -x</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">if [ $# -lt 2 ]; then</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; echo "Usage: $0
&lt;old_pv_path&gt; &lt;new_pv_path&gt;"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; exit 1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">fi</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">oldpv=$1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">newpv=$2</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">file_date=`date
"+%Y%m%d%H%M%S"`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">ns=`kubectl get namespace |grep
itsma | cut -f1 -d " "`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">if [ -d /tmp/Persistentvolume/pv
]; then</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; mv /tmp/Persistentvolume/pv
/tmp/Persistentvolume/pv.bak.${file_date}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">fi</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">if [ -d /tmp/Persistentvolume/pvc
]; then</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; mv
/tmp/Persistentvolume/pvc /tmp/Persistentvolume/pvc.bak.${file_date}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">fi</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">mkdir -p
/tmp/Persistentvolume/pvc/old</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">mkdir -p
/tmp/Persistentvolume/pvc/new</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">mkdir -p
/tmp/Persistentvolume/pv/old</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">mkdir -p
/tmp/Persistentvolume/pv/new</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">change_pv() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; file=$1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/annotations/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/kubernetes.io/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i
'/creatiofileTimestamp/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i
'/deletionGrfilecePeriodSeconds/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i
'/finalizers/d'file$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/selfLink/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/resourceVersion/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/uid/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i'/status/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/fileessage/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">change_pvc() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; file=$1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/annotations/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/kubernetes.io/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i
'/creationTimestamp/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i
'/deletionGracePeriodSeconds/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i -e
's/finalizers:/namespace: itsma1/g' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/selfLink/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/resourceVersion/d'
$file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/uid/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/status/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; sed -i '/message/d' $file</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">save_pvc() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `kubectl get pvc
-n $ns | grep -v NAME | grep $ns | cut -f1 -d " "`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; echo "save pvc:
$i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl get pvc $i
-n $ns -o yaml --export &gt; /tmp/Persistentvolume/pvc/old/${i}_pvc.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl get pvc $i
-n $ns -o yaml --export&gt; /tmp/Persistentvolume/pvc/new/${i}_pvc.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; change_pvc
/tmp/Persistentvolume/pvc/new/${i}_pvc.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Microsoft YaHei&quot;;
font-size:11.0pt">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">delete_pvc() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `kubectl get pvc
-n $ns | grep -v NAME | grep $ns | cut -f1 -d " "`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; echo "delete
pvc: $i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl patch pvc $i
-n $ns -p '{"metadata":{"finalizers": []}}' --type=merge</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl delete pvc
$i -n $ns --force --grace-period=0</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">save_pv() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `kubectl get pv |
grep -v NAME |&nbsp; grep $ns | cut -f1 -d " "`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; echo "save pv:
$i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl get pv $i -o
yaml --export &gt; /tmp/Persistentvolume/pv/old/${i}_pv.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl get pv $i -o
yaml --export| sed 's/'${oldpv}'/'${newpv}'/g' &gt;
/tmp/Persistentvolume/pv/new/${i}_pv.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; change_pvc
/tmp/Persistentvolume/pv/new/${i}_pv.yaml</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">delete_pv() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `kubectl get pv |
grep -v NAME |&nbsp; grep $ns| cut -f1 -d " "`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; echo "delete
pv: $i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl delete pv $i
--force --grace-period=0</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">create_pv() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `find
/tmp/Persistentvolume/pv/new -type f`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-size:13.5pt;color:black"><span style="font-style:italic;font-family:calibri">&nbsp; &nbsp; echo "create
pv</span><span style="font-style:italic;font-family:&quot;Microsoft YaHei&quot;">：</span><span style="font-style:italic;font-family:calibri"> $i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl create -f $i</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">create_pvc() {</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; for i in `find
/tmp/Persistentvolume/pvc/new -type f`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; do</span></p><p style="margin:0in;margin-left:.375in;font-size:13.5pt;color:black"><span style="font-style:italic;font-family:calibri">&nbsp; &nbsp; echo "create
pvc</span><span style="font-style:italic;font-family:&quot;Microsoft YaHei&quot;">：</span><span style="font-style:italic;font-family:calibri"> $i"</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; &nbsp; kubectl create -f $i</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; done</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">function check_pod(){</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">pod_name=$1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">echo checking pod status for
${pod_name}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">number=`kubectl get pods -n $ns -o
wide |grep ${pod_name} | awk -F " *|/" '($3!=$4 ||
$5!="Running") &amp;&amp; $5!="Completed" {print $0}' |wc
-l`</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">if [ $number -gt 0 ]; then</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; echo "Error: pod
($pod_name) is running, please make sure SMAX($ns) is stopped first."</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">&nbsp; exit 1</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">fi</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">}</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">check_pod rabbitmq</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">check_pod platform</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">check_pod idm</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">save_pv</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">save_pvc</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">delete_pvc</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">delete_pv</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">create_pv</span></p><p style="margin:0in;margin-left:.375in;font-family:calibri;font-size:13.5pt;
color:black"><span style="font-style:italic">create_pvc</span></p><p style="margin:0in;font-family:Calibri;font-size:11.0pt">





<!--StartFragment-->





















































































































































































































































































<!--EndFragment--></p><p style="margin:0in;margin-left:.375in;font-size:11.0pt;color:black"><span style="font-style:italic;font-family:calibri" lang="en-US">################
Script End&nbsp;</span><span style="font-style:italic;font-family:Calibri" lang="zh-CN">################&nbsp;</span></p></div></div></div>

<!--EndFragment-->