





<!--StartFragment-->

<p style="margin:0in;font-family:Calibri;font-size:11.0pt">After SMAX
installed, it is possible to change DB host from one server to another one,
current we only support change SMAX hostname of DB server, CDF is not included.</p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">Note: After running this script, SMAX needs to restart
and downtime occurs, planned maintenance window to do this.</span></p>

<ul type="disc" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Run the scripts below and it
     will do:</span></li>
 <ul type="circle" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
  margin-top:0in;margin-bottom:0in">
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Backup current DB configmap
      for Kubernetes cluster under /tmp/</span><span style="font-style:italic;
      font-family:Calibri;font-size:11.0pt">database/</span><span style="font-family:Calibri;font-size:11.0pt">/old folder</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Create new database yaml
      file in the new folder /tmp/</span><span style="font-style:italic;
      font-family:Calibri;font-size:11.0pt">database/</span><span style="font-family:Calibri;font-size:11.0pt">new</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Delete old configmap in
      Cluster</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Create new configmap in
      Cluster</span></li>
 </ul>
</ul>

<p style="margin: 0in;"><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;"># Scripts Begin&nbsp;</span><b style="font-size: inherit; letter-spacing: 0.2px; background-color: transparent;"><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span></b><br></p><p style="margin: 0in;"><span style="font-family: Calibri; font-size: 11pt; font-style: italic; color: rgb(120, 35, 12); letter-spacing: 0.2px; background-color: transparent;">#!/bin/bash</span><br></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">#set -x</span><span style="font-size: 11pt; letter-spacing: 0.2px; background-color: transparent;">&nbsp;</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">if [ $# -lt 2 ]; then</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; echo
"Usage: $0 &lt;old_DB_host&gt; &lt;new_DB_host&gt;"</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; exit 1</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">fi</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">olddb=$1</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">newdb=$2</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">file_date=`date "+%Y%m%d%H%M%S"`</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">ns=`kubectl get namespace |grep itsma | cut -f1 -d
" "`</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">if [ -d /tmp/database/old ]; then</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp; mv
/tmp/database/old /tmp/database/old.bak.${file_date}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">fi</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">if [ -d /tmp/database/new ]; then</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp; mv
/tmp/database/new /tmp/database/new.bak.${file_date}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">fi</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">mkdir -p /tmp/database/old</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">mkdir -p /tmp/database/new</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">save_database() {</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; kubectl get
cm database-configmap -n $ns -o yaml &gt;
/tmp/database/old/database-configmap.yaml</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">change_database() {</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; kubectl get
cm database-configmap -n $ns -o yaml | sed 's/'${olddb}'/'${newdb}'/g'&nbsp; &gt;
/tmp/database/new/database-configmap.yaml</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">delete_database() {</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; kubectl
delete -f /tmp/database/old/database-configmap.yaml</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">create_database() {</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">&nbsp;&nbsp;&nbsp; kubectl
create -f /tmp/database/new/database-configmap.yaml</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">}</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">save_database</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">change_database</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">delete_database</span></p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt;color:#78230C"><span style="font-style:italic">create_database</span></p><p style="font-size: 16px; margin: 0in;"><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;">#</span><span style="letter-spacing: 0.2px; background-color: transparent; color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic;"># Scripts End&nbsp;</span><span style="font-weight: 700; font-size: inherit; letter-spacing: 0.2px; background-color: transparent;"><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span><span style="color: rgb(120, 35, 12); font-family: Calibri; font-size: 14.6667px; font-style: italic; letter-spacing: 0.2px; background-color: transparent;">#</span></span></p>

<ul type="disc" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Check if database is changed
     correctly.</span></li>
</ul>

<p style="margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt;
color:#78230C"><span style="font-style:italic">kubectl get configmap -n
&lt;namespace&gt; database-configmap -o yaml |grep db_host</span></p>

<ul type="disc" style="margin-left:.375in;direction:ltr;unicode-bidi:embed;
 margin-top:0in;margin-bottom:0in">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">After checking all database
     configuration is set up correctly, Refer to document (</span><a href="https://docs.microfocus.com/itom/SMAX:2020.02/RestartSMASuite"><span style="font-family:Calibri;font-size:11.0pt">https://docs.microfocus.com/itom/SMAX:2020.02/RestartSMASuite</span></a><span style="font-family:Calibri;font-size:11.0pt">) to restart Kubernetes
     Cluster.</span></li>
</ul>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt">&nbsp;</p>

<p style="margin:0in;font-family:Calibri;font-size:11.0pt">&nbsp;</p>

<!--EndFragment-->