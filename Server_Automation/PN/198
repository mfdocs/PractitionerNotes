<p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">CustomerService provides access to persistent customer objects in SA. Customers can be associated with managed servers, folders, and other objects. Customers are used as security boundaries with user groups.<span class="anchor" id="line-1894"></span><span class="anchor" id="line-1895"></span></p><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Finding_a_customer" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Finding a customer</h2><span class="anchor" id="line-1896" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1897" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">A function that can be supplied with twistserver and either a customer name or the object ID and it will validate and return a CustomerRef.<span class="anchor" id="line-1898"></span><span class="anchor" id="line-1899"></span><span class="anchor" id="line-1900"></span><span class="anchor" id="line-1901"></span><span class="anchor" id="line-1902"></span><span class="anchor" id="line-1903"></span><span class="anchor" id="line-1904"></span><span class="anchor" id="line-1905"></span><span class="anchor" id="line-1906"></span><span class="anchor" id="line-1907"></span><span class="anchor" id="line-1908"></span><span class="anchor" id="line-1909"></span><span class="anchor" id="line-1910"></span><span class="anchor" id="line-1911"></span><span class="anchor" id="line-1912"></span><span class="anchor" id="line-1913"></span><span class="anchor" id="line-1914"></span><span class="anchor" id="line-1915"></span><span class="anchor" id="line-1916"></span><span class="anchor" id="line-1917"></span><span class="anchor" id="line-1918"></span><span class="anchor" id="line-1919"></span><span class="anchor" id="line-1-204"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.common</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">NotFoundException</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_2"></span><span class="anchor" id="line-2-105"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.locality</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">CustomerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_3"></span><span class="anchor" id="line-3-89"></span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_4"></span><span class="anchor" id="line-4-75"></span><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">get_customer_ref</span>(<span class="ID">ts</span>, <span class="ID">customer</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_5"></span><span class="anchor" id="line-5-71"></span>    <span class="String" style="color: rgb(0, 64, 128);">"""</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_6"></span><span class="anchor" id="line-6-63"></span><span class="String" style="color: rgb(0, 64, 128);">    Returns a CustomerRef given a customer name or id.  None if not found.</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_7"></span><span class="anchor" id="line-7-53"></span><span class="String" style="color: rgb(0, 64, 128);">    """</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_8"></span><span class="anchor" id="line-8-50"></span>    <span class="Comment" style="color: rgb(0, 128, 0);"># The name of a customer can be all digits, try first with the name </span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_9"></span><span class="anchor" id="line-9-44"></span>    <span class="Comment" style="color: rgb(0, 128, 0);"># and then with the id</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_10"></span><span class="anchor" id="line-10-39"></span>    <span class="ID">cust_refs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">CustomerVO.displayName = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">'</span> % <span class="ID">customer</span>, <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">customer</span><span class="String" style="color: rgb(0, 64, 128);">"</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_11"></span><span class="anchor" id="line-11-36"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ResWord" style="color: rgb(160, 0, 0);">len</span>(<span class="ID">cust_refs</span>) == <span class="Number" style="color: rgb(0, 128, 192);">1</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_12"></span><span class="anchor" id="line-12-34"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">return</span> <span class="ID">cust_refs</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_13"></span><span class="anchor" id="line-13-30"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">elif</span> <span class="ID">customer</span>.<span class="ID">isdigit</span>():</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_14"></span><span class="anchor" id="line-14-27"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">try</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_15"></span><span class="anchor" id="line-15-25"></span>            <span class="ID">cust_ref</span> = <span class="ID">CustomerRef</span>(<span class="ResWord" style="color: rgb(160, 0, 0);">long</span>(<span class="ID">customer</span>))</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_16"></span><span class="anchor" id="line-16-23"></span>            <span class="ID">ts</span>.<span class="ID">locality</span>.<span class="ID">CustomerService</span>.<span class="ID">getCustomerVO</span>(<span class="ID">cust_ref</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_17"></span><span class="anchor" id="line-17-22"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">return</span> <span class="ID">cust_ref</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_18"></span><span class="anchor" id="line-18-22"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">except</span> <span class="ID">NotFoundException</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_19"></span><span class="anchor" id="line-19-20"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">pass</span></span>
<span class="line"><span class="LineAnchor" id="CA-c4dc9a8edcc51e2f6e6333f5a9a4fefe8d6c5acc_20"></span><span class="anchor" id="line-20-18"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">return</span> <span class="ResWord" style="color: rgb(160, 0, 0);">None</span></span>
</pre></div></div><span class="anchor" id="line-1920" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1921" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Creating_customers" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Creating customers</h2><span class="anchor" id="line-1922" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1923" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">This example will create a set of customers attached to every facility. The&nbsp;<tt class="backtick"></tt><tt class="backtick">name</tt><tt class="backtick"></tt>&nbsp;field aka&nbsp;<tt class="backtick"></tt><tt class="backtick">Short&nbsp;Name</tt><tt class="backtick"></tt>&nbsp;must adhere to SA naming rules and the field will be automatically populated.<span class="anchor" id="line-1924"></span><span class="anchor" id="line-1925"></span><span class="anchor" id="line-1926"></span><span class="anchor" id="line-1927"></span><span class="anchor" id="line-1928"></span><span class="anchor" id="line-1929"></span><span class="anchor" id="line-1930"></span><span class="anchor" id="line-1931"></span><span class="anchor" id="line-1932"></span><span class="anchor" id="line-1933"></span><span class="anchor" id="line-1934"></span><span class="anchor" id="line-1935"></span><span class="anchor" id="line-1936"></span><span class="anchor" id="line-1937"></span><span class="anchor" id="line-1938"></span><span class="anchor" id="line-1939"></span><span class="anchor" id="line-1940"></span><span class="anchor" id="line-1941"></span><span class="anchor" id="line-1942"></span><span class="anchor" id="line-1943"></span><span class="anchor" id="line-1944"></span><span class="anchor" id="line-1945"></span><span class="anchor" id="line-1946"></span><span class="anchor" id="line-1-206"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_2"></span><span class="anchor" id="line-2-106"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_3"></span><span class="anchor" id="line-3-90"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.locality</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">CustomerVO</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_4"></span><span class="anchor" id="line-4-76"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.common</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">UniqueNameException</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_5"></span><span class="anchor" id="line-5-72"></span><span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">re</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_6"></span><span class="anchor" id="line-6-64"></span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_7"></span><span class="anchor" id="line-7-54"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_8"></span><span class="anchor" id="line-8-51"></span><span class="ID">shortChars</span> = <span class="ID">re</span>.<span class="ID">compile</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">[^0-9A-Z</span><span class="String" style="color: rgb(0, 64, 128);">\</span><span class="String" style="color: rgb(0, 64, 128);">-_]</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)            <span class="Comment" style="color: rgb(0, 128, 0);"># allowed chars</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_9"></span><span class="anchor" id="line-9-45"></span><span class="ID">sanitize</span> = <span class="ResWord" style="color: rgb(160, 0, 0);">lambda</span> <span class="ID">s</span>: <span class="ID">shortChars</span>.<span class="ID">sub</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="ID">s</span>.<span class="ID">upper</span>())  <span class="Comment" style="color: rgb(0, 128, 0);"># remove non-allowed</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_10"></span><span class="anchor" id="line-10-40"></span><span class="ID">allFacilityRefs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(<span class="ResWord" style="color: rgb(160, 0, 0);">None</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">facility</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_11"></span><span class="anchor" id="line-11-37"></span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_12"></span><span class="anchor" id="line-12-35"></span><span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">customer</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> [<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Red</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Blue</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Green</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Pink</span><span class="String" style="color: rgb(0, 64, 128);">'</span>]:</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_13"></span><span class="anchor" id="line-13-31"></span>    <span class="ID">VO</span> = <span class="ID">CustomerVO</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_14"></span><span class="anchor" id="line-14-28"></span>    <span class="ID">VO</span>.<span class="ID">name</span> = <span class="ID">sanitize</span>(<span class="ID">customer</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_15"></span><span class="anchor" id="line-15-26"></span>    <span class="ID">VO</span>.<span class="ID">displayName</span> = <span class="ID">customer</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_16"></span><span class="anchor" id="line-16-24"></span>    <span class="ID">VO</span>.<span class="ID">facilities</span> = <span class="ID">allFacilityRefs</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_17"></span><span class="anchor" id="line-17-23"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">try</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_18"></span><span class="anchor" id="line-18-23"></span>        <span class="ID">nVO</span> = <span class="ID">ts</span>.<span class="ID">locality</span>.<span class="ID">CustomerService</span>.<span class="ID">create</span>(<span class="ID">VO</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_19"></span><span class="anchor" id="line-19-21"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Created customer: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">nVO</span>.<span class="ID">ref</span></span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_20"></span><span class="anchor" id="line-20-19"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">except</span> <span class="ID">UniqueNameException</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-badec9c6bb3db7ece2fbec008501bb8dc4e50e0c_21"></span><span class="anchor" id="line-21-16"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Customer </span><span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);"> already exists</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">customer</span></span>
</pre></div></div><span class="anchor" id="line-1947" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-1948"></span><span class="anchor" id="line-1949"></span><span class="anchor" id="line-1950"></span><span class="anchor" id="line-1951"></span><span class="anchor" id="line-1952"></span><span class="anchor" id="line-1953"></span><span class="anchor" id="line-1954"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-37"></span>[root@dc1 CustomerService]# ./createCustomers.py
<span class="anchor" id="line-2-31"></span>Created customer: Mr Red (CustomerRef:190001)
<span class="anchor" id="line-3-22"></span>Created customer: Mr Blue (CustomerRef:200001)
<span class="anchor" id="line-4-17"></span>Created customer: Mr Green (CustomerRef:210001)
<span class="anchor" id="line-5-15"></span>Created customer: Mr Pink (CustomerRef:220001)</pre><span class="anchor" id="line-1955" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1956" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Remove_a_facility_relationship" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Remove a facility relationship</h2><span class="anchor" id="line-1957" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1958" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Assuming there is a facility named CHARLIE we will detach it from a list of customers<span class="anchor" id="line-1959"></span><span class="anchor" id="line-1960"></span><span class="anchor" id="line-1961"></span><span class="anchor" id="line-1962"></span><span class="anchor" id="line-1963"></span><span class="anchor" id="line-1964"></span><span class="anchor" id="line-1965"></span><span class="anchor" id="line-1966"></span><span class="anchor" id="line-1967"></span><span class="anchor" id="line-1968"></span><span class="anchor" id="line-1969"></span><span class="anchor" id="line-1970"></span><span class="anchor" id="line-1971"></span><span class="anchor" id="line-1-208"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_2"></span><span class="anchor" id="line-2-107"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_3"></span><span class="anchor" id="line-3-91"></span></span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_4"></span><span class="anchor" id="line-4-77"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_5"></span><span class="anchor" id="line-5-73"></span><span class="ID">FacilityRefs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">FacilityVO.name = CHARLIE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">facility</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_6"></span><span class="anchor" id="line-6-65"></span></span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_7"></span><span class="anchor" id="line-7-55"></span><span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">customer</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> [<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Red</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Blue</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Green</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Mr Pink</span><span class="String" style="color: rgb(0, 64, 128);">'</span>]:</span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_8"></span><span class="anchor" id="line-8-52"></span>    <span class="ID">refs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">CustomerVO.displayName = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">'</span> % <span class="ID">customer</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">customer</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_9"></span><span class="anchor" id="line-9-46"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Detaching from (</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">) </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % (<span class="ID">refs</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>], <span class="ID">customer</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-931fb6e30b179ca07ba5bd24c750661e1128d805_10"></span><span class="anchor" id="line-10-41"></span>    <span class="ID">ts</span>.<span class="ID">locality</span>.<span class="ID">CustomerService</span>.<span class="ID">removeFacilities</span>(<span class="ID">refs</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>],<span class="ID">FacilityRefs</span>)</span>
</pre></div></div><span class="anchor" id="line-1972" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-1973"></span><span class="anchor" id="line-1974"></span><span class="anchor" id="line-1975"></span><span class="anchor" id="line-1976"></span><span class="anchor" id="line-1977"></span><span class="anchor" id="line-1978"></span><span class="anchor" id="line-1979"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-38"></span>[root@dc1 CustomerService]# ./detachFacility.py
<span class="anchor" id="line-2-32"></span>Detaching from (Mr Red (CustomerRef:230001)) Mr Red
<span class="anchor" id="line-3-23"></span>Detaching from (Mr Blue (CustomerRef:240001)) Mr Blue
<span class="anchor" id="line-4-18"></span>Detaching from (Mr Green (CustomerRef:250001)) Mr Green
<span class="anchor" id="line-5-16"></span>Detaching from (Mr Pink (CustomerRef:260001)) Mr Pink</pre>