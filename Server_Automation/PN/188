<p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">ServerService provides access to the servers managed by Server Automation.<span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span></p><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Updating_a_server_property" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Updating a server property</h2><span class="anchor" id="line-525" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-526" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Find a server and examine its stage property updating it to be LIVE if its not already.<span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span><span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span><span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span><span class="anchor" id="line-534"></span><span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><span class="anchor" id="line-542"></span><span class="anchor" id="line-543"></span><span class="anchor" id="line-544"></span><span class="anchor" id="line-545"></span><span class="anchor" id="line-546"></span><span class="anchor" id="line-1-61"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_2"></span><span class="anchor" id="line-2-22"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_3"></span><span class="anchor" id="line-3-19"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.search</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">Filter</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_4"></span><span class="anchor" id="line-4-11"></span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_5"></span><span class="anchor" id="line-5-10"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_6"></span><span class="anchor" id="line-6-8"></span><span class="ID">ServerService</span> = <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_7"></span><span class="anchor" id="line-7-4"></span><span class="ID">ts</span>.<span class="ID">authenticate</span>(<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">user</span><span class="String" style="color: rgb(0, 64, 128);">"</span>,<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">"</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_8"></span><span class="anchor" id="line-8-4"></span><span class="ID">f</span> = <span class="ID">Filter</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_9"></span><span class="anchor" id="line-9-3"></span><span class="ID">f</span>.<span class="ID">expression</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ServerVO.name = win2003-bt7xcc6</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_10"></span><span class="anchor" id="line-10-3"></span><span class="ID">foundServers</span> = <span class="ID">ServerService</span>.<span class="ID">findServerRefs</span>(<span class="ID">f</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_11"></span><span class="anchor" id="line-11-1"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ID">foundServers</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_12"></span><span class="anchor" id="line-12-1"></span>    <span class="ID">serverRef</span> = <span class="ID">foundServers</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_13"></span><span class="anchor" id="line-13-1"></span>    <span class="ID">vo</span> = <span class="ID">ServerService</span>.<span class="ID">getServerVO</span>(<span class="ID">serverRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_14"></span><span class="anchor" id="line-14-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Current stage -&gt; </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">vo</span>.<span class="ID">stage</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_15"></span><span class="anchor" id="line-15-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ID">vo</span>.<span class="ID">stage</span> != <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">LIVE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_16"></span><span class="anchor" id="line-16-1"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Updating to LIVE</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_17"></span><span class="anchor" id="line-17-1"></span>        <span class="ID">vo</span>.<span class="ID">stage</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">LIVE</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-8ddca04c7c83dfc78df6b83e2eaa113f6b5f9629_18"></span><span class="anchor" id="line-18-1"></span>        <span class="ID">ServerService</span>.<span class="ID">update</span>(<span class="ID">serverRef</span>, <span class="ID">vo</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>)</span>
</pre></div></div><span class="anchor" id="line-547" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution:<span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span><span class="anchor" id="line-550"></span><span class="anchor" id="line-551"></span><span class="anchor" id="line-552"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-8"></span>[root@dc1 demo]# ./updateServerState.py
<span class="anchor" id="line-2-7"></span>Current stage -&gt; UNKNOWN
<span class="anchor" id="line-3-4"></span>Updating to LIVE</pre><span class="anchor" id="line-553" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">This is the pattern used to update a property of any Value Object. If multiple properties are to be updated a single update should be issued at the completion of modifying the VO object in memory. A dirty flag can be set to indicate if an update is required.<span class="anchor" id="line-554"></span><span class="anchor" id="line-555"></span></p><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Lets talk about this statement some more<span class="anchor" id="line-556"></span><span class="anchor" id="line-557"></span><span class="anchor" id="line-558"></span><span class="anchor" id="line-1-63"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-80552d5c69677b67abf6ff1f58b40187e9dd63bc" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line">        <span class="ID">ServerService</span>.<span class="ID">update</span>(<span class="ID">serverRef</span>, <span class="ID">vo</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>)</span>
</pre></div></div><span class="anchor" id="line-559" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The two Boolean values are force and refresh in that order:<span class="anchor" id="line-560"></span></p><ul style="color: rgb(0, 0, 0); font-family: sans-serif;"><li><p class="line891" style="margin: 0.25em 0px;"><strong>force</strong>&nbsp;- If true, this operation will overwrite edits made since the VO was first read. Otherwise, if this operation detects that the object has been edited since the VO was first read, it throws a ModifiedException. An object is considered edited if its modifiedDate is greater than VO.modifiedDate.<span class="anchor" id="line-561"></span></p></li><li><p class="line891" style="margin: 0.25em 0px;"><strong>refetch</strong>&nbsp;- true if update is to return the updated data representation of the server object.<span class="anchor" id="line-562"></span><span class="anchor" id="line-563"></span></p></li></ul><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">As the return value of the update statement is not required refetch should be set to False to avoid the Twist having to refetch the object which incurs a minor overhead.<span class="anchor" id="line-564"></span><span class="anchor" id="line-565"></span></p><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The force flag should be used with caution as its not just the stage change that will be forced back onto the VO if it has been changed by somebody else in the system. The exact state that that the server was in when it was read will written back potentially overwriting somebody else's changes. It would be better that we handle the exception and re-read the server and check our attribute again.<span class="anchor" id="line-566"></span><span class="anchor" id="line-567"></span></p><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">With that an mind we would code this:<span class="anchor" id="line-568"></span><span class="anchor" id="line-569"></span><span class="anchor" id="line-570"></span><span class="anchor" id="line-571"></span><span class="anchor" id="line-572"></span><span class="anchor" id="line-573"></span><span class="anchor" id="line-574"></span><span class="anchor" id="line-575"></span><span class="anchor" id="line-576"></span><span class="anchor" id="line-577"></span><span class="anchor" id="line-578"></span><span class="anchor" id="line-579"></span><span class="anchor" id="line-580"></span><span class="anchor" id="line-581"></span><span class="anchor" id="line-582"></span><span class="anchor" id="line-583"></span><span class="anchor" id="line-584"></span><span class="anchor" id="line-585"></span><span class="anchor" id="line-586"></span><span class="anchor" id="line-587"></span><span class="anchor" id="line-1-65"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.common</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ModifiedException</span>, <span class="ID">NotFoundException</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_2"></span><span class="anchor" id="line-2-23"></span>...</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_3"></span><span class="anchor" id="line-3-20"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ID">foundServers</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_4"></span><span class="anchor" id="line-4-12"></span>    <span class="ID">serverRef</span> = <span class="ID">foundServers</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_5"></span><span class="anchor" id="line-5-11"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">while</span> <span class="ResWord" style="color: rgb(160, 0, 0);">True</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_6"></span><span class="anchor" id="line-6-9"></span>       <span class="ID">vo</span> = <span class="ID">ServerService</span>.<span class="ID">getServerVO</span>(<span class="ID">serverRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_7"></span><span class="anchor" id="line-7-5"></span>       <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Current stage -&gt; </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">vo</span>.<span class="ID">stage</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_8"></span><span class="anchor" id="line-8-5"></span>       <span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ID">vo</span>.<span class="ID">stage</span> != <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">LIVE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_9"></span><span class="anchor" id="line-9-4"></span>           <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Updating to LIVE</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_10"></span><span class="anchor" id="line-10-4"></span>           <span class="ID">vo</span>.<span class="ID">stage</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">LIVE</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_11"></span><span class="anchor" id="line-11-2"></span>           <span class="ResWord" style="color: rgb(160, 0, 0);">try</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_12"></span><span class="anchor" id="line-12-2"></span>              <span class="ID">ServerService</span>.<span class="ID">update</span>(<span class="ID">serverRef</span>, <span class="ID">vo</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_13"></span><span class="anchor" id="line-13-2"></span>           <span class="ResWord" style="color: rgb(160, 0, 0);">except</span> <span class="ID">ModifiedException</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_14"></span><span class="anchor" id="line-14-2"></span>              <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">VO changed after we read it.  Retrying...</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_15"></span><span class="anchor" id="line-15-2"></span>              <span class="ResWord" style="color: rgb(160, 0, 0);">continue</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_16"></span><span class="anchor" id="line-16-2"></span>           <span class="ResWord" style="color: rgb(160, 0, 0);">except</span> <span class="ID">NotFoundException</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_17"></span><span class="anchor" id="line-17-2"></span>              <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Server was deleted after we read it and before we could update it.</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-060c60eca20855b2c0f660bd6d3e3c5fc609d9cd_18"></span><span class="anchor" id="line-18-2"></span>       <span class="ResWord" style="color: rgb(160, 0, 0);">break</span></span>
</pre></div></div><span class="anchor" id="line-588" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Of course you could just risk it and not bother with the exception handling but if you are trying to build robust production code its something that should be taken into consideration especially if there is a long period between the read and update where the data could mutate. Also note that not all attributes of the VO are mutable. The Java doc manage page for the update method in the&nbsp;<tt class="backtick"></tt><tt class="backtick">ServerService</tt><tt class="backtick"></tt>&nbsp;lists those that may be updated.<span class="anchor" id="line-589"></span><span class="anchor" id="line-590"></span></p><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Decommission" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Decommission</h2><span class="anchor" id="line-591" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-592" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">To decomission a server we use the&nbsp;<tt class="backtick"></tt><tt class="backtick">decommission(ServerRef)</tt><tt class="backtick"></tt>&nbsp;method of the ServerService. By way of example a script to purge servers by their Object ID (mid - Machine ID)<span class="anchor" id="line-593"></span><span class="anchor" id="line-594"></span><span class="anchor" id="line-595"></span><span class="anchor" id="line-596"></span><span class="anchor" id="line-597"></span><span class="anchor" id="line-598"></span><span class="anchor" id="line-599"></span><span class="anchor" id="line-600"></span><span class="anchor" id="line-601"></span><span class="anchor" id="line-602"></span><span class="anchor" id="line-603"></span><span class="anchor" id="line-604"></span><span class="anchor" id="line-605"></span><span class="anchor" id="line-606"></span><span class="anchor" id="line-607"></span><span class="anchor" id="line-608"></span><span class="anchor" id="line-609"></span><span class="anchor" id="line-610"></span><span class="anchor" id="line-611"></span><span class="anchor" id="line-612"></span><span class="anchor" id="line-613"></span><span class="anchor" id="line-614"></span><span class="anchor" id="line-615"></span><span class="anchor" id="line-616"></span><span class="anchor" id="line-617"></span><span class="anchor" id="line-618"></span><span class="anchor" id="line-619"></span><span class="anchor" id="line-1-67"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_2"></span><span class="anchor" id="line-2-24"></span><span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">sys</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_3"></span><span class="anchor" id="line-3-21"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_4"></span><span class="anchor" id="line-4-13"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_5"></span><span class="anchor" id="line-5-12"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.common</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">NotFoundException</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_6"></span><span class="anchor" id="line-6-10"></span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_7"></span><span class="anchor" id="line-7-6"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ResWord" style="color: rgb(160, 0, 0);">len</span>(<span class="ID">sys</span>.<span class="ID">argv</span>) &lt; <span class="Number" style="color: rgb(0, 128, 192);">2</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_8"></span><span class="anchor" id="line-8-6"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Usage: purgeServers &lt;id_file&gt;</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_9"></span><span class="anchor" id="line-9-5"></span>    <span class="ID">sys</span>.<span class="ID">exit</span>(<span class="Number" style="color: rgb(0, 128, 192);">0</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_10"></span><span class="anchor" id="line-10-5"></span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_11"></span><span class="anchor" id="line-11-3"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_12"></span><span class="anchor" id="line-12-3"></span><span class="ID">ts</span>.<span class="ID">authenticate</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">user</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_13"></span><span class="anchor" id="line-13-3"></span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_14"></span><span class="anchor" id="line-14-3"></span><span class="ResWord" style="color: rgb(160, 0, 0);">with</span> <span class="ResWord" style="color: rgb(160, 0, 0);">open</span>(<span class="ID">sys</span>.<span class="ID">argv</span>[<span class="Number" style="color: rgb(0, 128, 192);">1</span>],<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">r</span><span class="String" style="color: rgb(0, 64, 128);">"</span>) <span class="ResWord" style="color: rgb(160, 0, 0);">as</span> <span class="ID">f</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_15"></span><span class="anchor" id="line-15-3"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">line</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> <span class="ID">f</span>.<span class="ID">readlines</span>():</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_16"></span><span class="anchor" id="line-16-3"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">try</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_17"></span><span class="anchor" id="line-17-3"></span>            <span class="ID">mid</span> = <span class="ResWord" style="color: rgb(160, 0, 0);">long</span>(<span class="ID">line</span>.<span class="ID">strip</span>())</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_18"></span><span class="anchor" id="line-18-3"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">try</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_19"></span><span class="anchor" id="line-19-1"></span>                <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">decommission</span>(<span class="ID">ServerRef</span>(<span class="ID">mid</span>))</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_20"></span><span class="anchor" id="line-20-1"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">except</span> <span class="ID">NotFoundException</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_21"></span><span class="anchor" id="line-21-1"></span>                <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Server </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);"> not found</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">mid</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_22"></span><span class="anchor" id="line-22-1"></span>                <span class="ResWord" style="color: rgb(160, 0, 0);">continue</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_23"></span><span class="anchor" id="line-23-1"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Decomissioning server </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">mid</span></span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_24"></span><span class="anchor" id="line-24-1"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">except</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-d3b6c6761793f06753fa78a246a8a5a989bb8041_25"></span><span class="anchor" id="line-25-1"></span>            <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Invalid ID - </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">line</span></span>
</pre></div></div><span class="anchor" id="line-620" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Data file: id.txt<span class="anchor" id="line-621"></span><span class="anchor" id="line-622"></span><span class="anchor" id="line-623"></span><span class="anchor" id="line-624"></span><span class="anchor" id="line-625"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-9"></span>91170001
<span class="anchor" id="line-2-8"></span>91180001
<span class="anchor" id="line-3-5"></span>91190001</pre><span class="anchor" id="line-626" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-627"></span><span class="anchor" id="line-628"></span><span class="anchor" id="line-629"></span><span class="anchor" id="line-630"></span><span class="anchor" id="line-631"></span><span class="anchor" id="line-632"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-10"></span>[root@dc1 demo]# ./purgeServers.py id.txt
<span class="anchor" id="line-2-9"></span>Decomissioning server 91170001
<span class="anchor" id="line-3-6"></span>Decomissioning server 91180001
<span class="anchor" id="line-4-4"></span>Server 91190001 not found</pre><span class="anchor" id="line-633" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">This could easily be modified to use the&nbsp;<tt class="backtick"></tt><tt class="backtick">findServerRefs()</tt><tt class="backtick"></tt>&nbsp;method and a&nbsp;<tt class="backtick"></tt><tt class="backtick">Filter</tt><tt class="backtick"></tt>&nbsp;to find a server by its name, ip address or some other attribute to obtain the&nbsp;<tt class="backtick"></tt><tt class="backtick">ServerRef</tt><tt class="backtick"></tt>.<span class="anchor" id="line-634"></span><span class="anchor" id="line-635"></span></p><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Update_custom_attributes" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Update custom attributes</h2><span class="anchor" id="line-636" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-637" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Multiple custom attributes can be updated in a single call by supplying a dictionary of name/value pairs.<span class="anchor" id="line-638"></span><span class="anchor" id="line-639"></span><span class="anchor" id="line-640"></span><span class="anchor" id="line-641"></span><span class="anchor" id="line-642"></span><span class="anchor" id="line-643"></span><span class="anchor" id="line-644"></span><span class="anchor" id="line-645"></span><span class="anchor" id="line-646"></span><span class="anchor" id="line-647"></span><span class="anchor" id="line-648"></span><span class="anchor" id="line-1-69"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_2"></span><span class="anchor" id="line-2-25"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_3"></span><span class="anchor" id="line-3-22"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_4"></span><span class="anchor" id="line-4-14"></span></span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_5"></span><span class="anchor" id="line-5-13"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_6"></span><span class="anchor" id="line-6-11"></span></span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_7"></span><span class="anchor" id="line-7-7"></span><span class="ID">CAMap</span> = {<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">hello</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">world</span><span class="String" style="color: rgb(0, 64, 128);">'</span>, <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">foo</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">bar</span><span class="String" style="color: rgb(0, 64, 128);">'</span>}</span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_8"></span><span class="anchor" id="line-8-7"></span><span class="ID">ref</span> = <span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">10001</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-da2e6423e1dcb574b5db10e1ecb4474e9e6647d5_9"></span><span class="anchor" id="line-9-6"></span><span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">setCustAttrs</span>(<span class="ID">ref</span>, <span class="ID">CAMap</span>)</span>
</pre></div></div><span class="anchor" id="line-649" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-650" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Fetch_custom_attributes" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Fetch custom attributes</h2><span class="anchor" id="line-651" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-652" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">When fetching custom attribute you need to qualify if you want to fetch with regards to inheritance or not. Calculating the inherited attributes is more compute intensive than not doing so if you don't require the inherited data you should set the&nbsp;<tt class="backtick"></tt><tt class="backtick">useScope</tt><tt class="backtick"></tt>&nbsp;value to False.<span class="anchor" id="line-653"></span><span class="anchor" id="line-654"></span><span class="anchor" id="line-655"></span><span class="anchor" id="line-656"></span><span class="anchor" id="line-657"></span><span class="anchor" id="line-658"></span><span class="anchor" id="line-659"></span><span class="anchor" id="line-660"></span><span class="anchor" id="line-1-71"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c_2"></span><span class="anchor" id="line-2-26"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c_3"></span><span class="anchor" id="line-3-23"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c_4"></span><span class="anchor" id="line-4-15"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c_5"></span><span class="anchor" id="line-5-14"></span><span class="ID">ref</span> = <span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">10001</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-09e2e671ac6af4b8629153f3edc1e243b925912c_6"></span><span class="anchor" id="line-6-12"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">getCustAttrs</span>(<span class="ID">ref</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">None</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">False</span>)</span>
</pre></div></div><span class="anchor" id="line-661" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution with only return key/values that have a&nbsp;<strong>Locally Specified Value</strong><span class="anchor" id="line-662"></span><span class="anchor" id="line-663"></span><span class="anchor" id="line-664"></span><span class="anchor" id="line-665"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-11"></span>[root@dc1 ServerService]# ./fetchCustAttr.py
<span class="anchor" id="line-2-10"></span>{'hello': 'world', 'AGENT_STAGE_STATUS': '70.0.76793.1', 'foo': 'bar', '__OPSW_reachability_time': '1571140803.85'}</pre><span class="anchor" id="line-666" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-667" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><div><br></div><img src="./mediawiki/images/PN/ServerCustomAttributes.png"><br><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Those custom attributes beginning with&nbsp;<tt class="backtick"></tt><tt class="backtick">__OPSW</tt><tt class="backtick"></tt>&nbsp;are private and should not be tampered with.<span class="anchor" id="line-670"></span><span class="anchor" id="line-671"></span><span class="anchor" id="line-672"></span><span class="anchor" id="line-673"></span><span class="anchor" id="line-674"></span><span class="anchor" id="line-1-73"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-8f60137e6043d2f7ae71d017bb6b3914809bf651" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line">&gt;&gt;&gt; <span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.custattr</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">CustomAttribute</span></span>
<span class="line"><span class="LineAnchor" id="CA-8f60137e6043d2f7ae71d017bb6b3914809bf651_2"></span><span class="anchor" id="line-2-27"></span>&gt;&gt;&gt; <span class="ID">CustomAttribute</span>.<span class="ID">OPSWARE_PRIVATE_KEY_PREFIX</span></span>
<span class="line"><span class="LineAnchor" id="CA-8f60137e6043d2f7ae71d017bb6b3914809bf651_3"></span><span class="anchor" id="line-3-24"></span><span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">__OPSW</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
</pre></div></div><span class="anchor" id="line-675" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-676" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Encrypted_custom_attributes" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Encrypted custom attributes</h2><span class="anchor" id="line-677" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-678" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Quite often there is a need to store sensitive data such as password information into a custom attribute. SA provides the ability to create your own namespace and have the storage of information into it be transparently encrypted/decrypted when saving/restoring from the database. These custom namespaces are not visible in the UI and may only be accessed pro grammatically.<span class="anchor" id="line-679"></span><span class="anchor" id="line-680"></span></p><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">In this example we create a PASSWORD namespace and indicate that all attributes put into it should be encrypted when stored to the database. Although we are attaching the custom attributes to a Server this same approach works with; Customers, DataCenters, DeviceGroups, OS Build Plans and Software Policies.<span class="anchor" id="line-681"></span><span class="anchor" id="line-682"></span><span class="anchor" id="line-683"></span><span class="anchor" id="line-684"></span><span class="anchor" id="line-685"></span><span class="anchor" id="line-686"></span><span class="anchor" id="line-687"></span><span class="anchor" id="line-688"></span><span class="anchor" id="line-689"></span><span class="anchor" id="line-690"></span><span class="anchor" id="line-691"></span><span class="anchor" id="line-692"></span><span class="anchor" id="line-693"></span><span class="anchor" id="line-694"></span><span class="anchor" id="line-695"></span><span class="anchor" id="line-696"></span><span class="anchor" id="line-697"></span><span class="anchor" id="line-698"></span><span class="anchor" id="line-699"></span><span class="anchor" id="line-700"></span><span class="anchor" id="line-701"></span><span class="anchor" id="line-702"></span><span class="anchor" id="line-703"></span><span class="anchor" id="line-704"></span><span class="anchor" id="line-705"></span><span class="anchor" id="line-706"></span><span class="anchor" id="line-707"></span><span class="anchor" id="line-1-75"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_2"></span><span class="anchor" id="line-2-28"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_3"></span><span class="anchor" id="line-3-25"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_4"></span><span class="anchor" id="line-4-16"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.custattr</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">CustAttrNamespaceVO</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_5"></span><span class="anchor" id="line-5-15"></span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_6"></span><span class="anchor" id="line-6-13"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_7"></span><span class="anchor" id="line-7-8"></span><span class="ID">SS</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_8"></span><span class="anchor" id="line-8-8"></span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_9"></span><span class="anchor" id="line-9-7"></span><span class="ID">nsName</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">PASSWORDS</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_10"></span><span class="anchor" id="line-10-6"></span><span class="ID">nsRef</span> = <span class="ID">SS</span>.<span class="ID">findObjRefs</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">CustAttrNamespaceVO.name = </span><span class="String" style="color: rgb(0, 64, 128);">'</span>+<span class="ID">nsName</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_11"></span><span class="anchor" id="line-11-4"></span>                       <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">cust_attr_namespace</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_12"></span><span class="anchor" id="line-12-4"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ResWord" style="color: rgb(160, 0, 0);">not</span> <span class="ID">nsRef</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_13"></span><span class="anchor" id="line-13-4"></span>    <span class="ID">vo</span> = <span class="ID">CustAttrNamespaceVO</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_14"></span><span class="anchor" id="line-14-4"></span>    <span class="ID">vo</span>.<span class="ID">storageType</span> = <span class="ID">CustAttrNamespaceVO</span>.<span class="ID">STORAGE_TYPE_ENCRYPTED</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_15"></span><span class="anchor" id="line-15-4"></span>    <span class="ID">vo</span>.<span class="ID">name</span> = <span class="ID">nsName</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_16"></span><span class="anchor" id="line-16-4"></span>    <span class="ID">vo</span>.<span class="ID">description</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Password data</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_17"></span><span class="anchor" id="line-17-4"></span>    <span class="ID">ts</span>.<span class="ID">custattr</span>.<span class="ID">CustAttrNamespaceService</span>.<span class="ID">create</span>(<span class="ID">vo</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_18"></span><span class="anchor" id="line-18-4"></span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_19"></span><span class="anchor" id="line-19-2"></span><span class="ID">ref</span> = <span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">10001</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_20"></span><span class="anchor" id="line-20-2"></span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_21"></span><span class="anchor" id="line-21-2"></span><span class="Comment" style="color: rgb(0, 128, 0);"># Setting an attribute key/value pair</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_22"></span><span class="anchor" id="line-22-2"></span><span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">setCustAttr</span>(<span class="ID">ref</span>,<span class="ID">nsName</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">its a secret</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_23"></span><span class="anchor" id="line-23-2"></span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_24"></span><span class="anchor" id="line-24-2"></span><span class="Comment" style="color: rgb(0, 128, 0);"># Getting an attribute value</span></span>
<span class="line"><span class="LineAnchor" id="CA-fb6eea71f18f001e007e0bc57aa1cbb0e5d279c3_25"></span><span class="anchor" id="line-25-2"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">getCustAttr</span>(<span class="ID">ref</span>,<span class="ID">nsName</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="ResWord" style="color: rgb(160, 0, 0);">False</span>)</span>
</pre></div></div><span class="anchor" id="line-708" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-709" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Running_a_communication_test" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Running a communication test</h2><span class="anchor" id="line-710" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-711" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The call to create a job that will execute a communication test on a group of servers is a single call. Its supplied with a list of servers to run against.<span class="anchor" id="line-712"></span><span class="anchor" id="line-713"></span><span class="anchor" id="line-714"></span><span class="anchor" id="line-715"></span><span class="anchor" id="line-716"></span><span class="anchor" id="line-717"></span><span class="anchor" id="line-718"></span><span class="anchor" id="line-719"></span><span class="anchor" id="line-720"></span><span class="anchor" id="line-721"></span><span class="anchor" id="line-1-77"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_2"></span><span class="anchor" id="line-2-29"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_3"></span><span class="anchor" id="line-3-26"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_4"></span><span class="anchor" id="line-4-17"></span><span class="ID">serverRefs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(</span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_5"></span><span class="anchor" id="line-5-16"></span>    <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ServerVO.osVersion = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Linux 7SERVER-X86_64</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);"> </span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_6"></span><span class="anchor" id="line-6-14"></span>    <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">device</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_7"></span><span class="anchor" id="line-7-9"></span><span class="ID">jobRef</span> = <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">runAgentCommTest</span>(<span class="ID">serverRefs</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-4a4d71a44c25a245d148c6c7727407250d5f5cee_8"></span><span class="anchor" id="line-8-9"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Created comm test job </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobRef</span></span>
</pre></div></div><span class="anchor" id="line-722" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-723"></span><span class="anchor" id="line-724"></span><span class="anchor" id="line-725"></span><span class="anchor" id="line-726"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-12"></span>[root@dc1 ServerService]# ./commsTest.py
<span class="anchor" id="line-2-11"></span>Created comm test job Communication Test (JobRef:143700001)</pre><span class="anchor" id="line-727" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-728" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Display_communication_test_results" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Display communication test results</h2><span class="anchor" id="line-729" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-730" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Textual representation of what is displayed in the GUI interface<span class="anchor" id="line-731"></span><span class="anchor" id="line-732"></span><span class="anchor" id="line-733"></span><span class="anchor" id="line-734"></span><span class="anchor" id="line-735"></span><span class="anchor" id="line-736"></span><span class="anchor" id="line-737"></span><span class="anchor" id="line-738"></span><span class="anchor" id="line-739"></span><span class="anchor" id="line-740"></span><span class="anchor" id="line-741"></span><span class="anchor" id="line-742"></span><span class="anchor" id="line-743"></span><span class="anchor" id="line-744"></span><span class="anchor" id="line-745"></span><span class="anchor" id="line-746"></span><span class="anchor" id="line-747"></span><span class="anchor" id="line-748"></span><span class="anchor" id="line-749"></span><span class="anchor" id="line-750"></span><span class="anchor" id="line-751"></span><span class="anchor" id="line-752"></span><span class="anchor" id="line-753"></span><span class="anchor" id="line-1-79"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_2"></span><span class="anchor" id="line-2-30"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_3"></span><span class="anchor" id="line-3-27"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.job</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">JobRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_4"></span><span class="anchor" id="line-4-18"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">CommTestJobResult</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_5"></span><span class="anchor" id="line-5-17"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_6"></span><span class="anchor" id="line-6-15"></span><span class="ID">jobRef</span> = <span class="ID">JobRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">143700001</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_7"></span><span class="anchor" id="line-7-10"></span><span class="ID">jr</span> = <span class="ID">ts</span>.<span class="ID">job</span>.<span class="ID">JobService</span>.<span class="ID">getResult</span>(<span class="ID">jobRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_8"></span><span class="anchor" id="line-8-10"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ResWord" style="color: rgb(160, 0, 0);">isinstance</span>(<span class="ID">jr</span>,<span class="ID">CommTestJobResult</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_9"></span><span class="anchor" id="line-9-8"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);"> of </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);"> completed</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % (<span class="ID">jr</span>.<span class="ID">totalCompleted</span>,<span class="ID">jr</span>.<span class="ID">totalDvcs</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_10"></span><span class="anchor" id="line-10-7"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%30s</span><span class="String" style="color: rgb(0, 64, 128);"> AGT CRP  CE DAE SWR  MD</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);"> </span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_11"></span><span class="anchor" id="line-11-5"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">je</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> <span class="ID">jr</span>.<span class="ID">elemResultInfo</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_12"></span><span class="anchor" id="line-12-5"></span>        <span class="ID">agt</span> = <span class="ID">je</span>.<span class="ID">agentReachable</span> <span class="Comment" style="color: rgb(0, 128, 0);"># AGenT</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_13"></span><span class="anchor" id="line-13-5"></span>        <span class="ID">crp</span> = <span class="ID">je</span>.<span class="ID">cryptoOk</span>       <span class="Comment" style="color: rgb(0, 128, 0);"># CRyPto</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_14"></span><span class="anchor" id="line-14-5"></span>        <span class="ID">ce</span> = <span class="ID">je</span>.<span class="ID">wayReachable</span>    <span class="Comment" style="color: rgb(0, 128, 0);"># Command Engine</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_15"></span><span class="anchor" id="line-15-5"></span>        <span class="ID">dae</span> = <span class="ID">je</span>.<span class="ID">spinReachable</span>  <span class="Comment" style="color: rgb(0, 128, 0);"># Data Access Engine</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_16"></span><span class="anchor" id="line-16-5"></span>        <span class="ID">swr</span> = <span class="ID">je</span>.<span class="ID">wordReachable</span>  <span class="Comment" style="color: rgb(0, 128, 0);"># SoftWare Repository</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_17"></span><span class="anchor" id="line-17-5"></span>        <span class="ID">md</span> = <span class="ID">je</span>.<span class="ID">midOk</span>           <span class="Comment" style="color: rgb(0, 128, 0);"># Machine iD</span></span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_18"></span><span class="anchor" id="line-18-5"></span>        <span class="ID">result</span> = <span class="ResWord" style="color: rgb(160, 0, 0);">map</span>(<span class="ResWord" style="color: rgb(160, 0, 0);">lambda</span> <span class="ID">i</span>: {<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">None</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">-</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">0</span><span class="String" style="color: rgb(0, 64, 128);">'</span>:<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">O</span><span class="String" style="color: rgb(0, 64, 128);">'</span>}.<span class="ID">get</span>(<span class="ID">i</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">X</span><span class="String" style="color: rgb(0, 64, 128);">'</span>),</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_19"></span><span class="anchor" id="line-19-3"></span>                     [<span class="ID">agt</span>,<span class="ID">crp</span>,<span class="ID">ce</span>,<span class="ID">dae</span>,<span class="ID">swr</span>,<span class="ID">md</span>])</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_20"></span><span class="anchor" id="line-20-3"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%30s</span><span class="String" style="color: rgb(0, 64, 128);">  </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % (<span class="ID">je</span>.<span class="ID">name</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">   </span><span class="String" style="color: rgb(0, 64, 128);">'</span>.<span class="ID">join</span>(<span class="ID">result</span>))</span>
<span class="line"><span class="LineAnchor" id="CA-3cf1e45092af844dfa279cb7ff4540a11dbfc846_21"></span><span class="anchor" id="line-21-3"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Failures: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jr</span>.<span class="ID">totalFailed</span></span>
</pre></div></div><span class="anchor" id="line-754" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-755"></span><span class="anchor" id="line-756"></span><span class="anchor" id="line-757"></span><span class="anchor" id="line-758"></span><span class="anchor" id="line-759"></span><span class="anchor" id="line-760"></span><span class="anchor" id="line-761"></span><span class="anchor" id="line-762"></span><span class="anchor" id="line-763"></span><span class="anchor" id="line-764"></span><span class="anchor" id="line-765"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-13"></span>[root@dc1 ServerService]# ./commTestResults.py
<span class="anchor" id="line-2-12"></span>5 of 5 completed
<span class="anchor" id="line-3-7"></span>                               AGT CRP  CE DAE SWR  MD
<span class="anchor" id="line-4-5"></span>                dc1.blue.local  O   O   O   O   O   O
<span class="anchor" id="line-5-3"></span>               sat1.blue.local  O   O   O   O   O   O
<span class="anchor" id="line-6-3"></span>               dc1.green.local  X   -   -   -   -   -
<span class="anchor" id="line-7-3"></span>            zuludb.green.local  X   -   -   -   -   -
<span class="anchor" id="line-8-3"></span>            charlie.pink.local  O   O   O   O   O   O
<span class="anchor" id="line-9-1"></span>Failures: 2</pre><span class="anchor" id="line-766" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-767" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Note the order is different as the GUI is sorted by hostname.<span class="anchor" id="line-768"></span><span class="anchor" id="line-769"></span></p><img src="./mediawiki/images/PN/CommTestResult.png"><br><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Rebooting_a_server" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Rebooting a server</h2><span class="anchor" id="line-772" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-773" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">To immediately reboot a server the following can be performed. The first argument to startReboot is a list of ServerRefs in this example its a list of one. Even thou no schedule or notification is required empty class objects must be supplied. Examine&nbsp;"Scheduling a server script against servers"&nbsp;to see how these could be populated.<span class="anchor" id="line-774"></span><span class="anchor" id="line-775"></span><span class="anchor" id="line-776"></span><span class="anchor" id="line-777"></span><span class="anchor" id="line-778"></span><span class="anchor" id="line-779"></span><span class="anchor" id="line-780"></span><span class="anchor" id="line-781"></span><span class="anchor" id="line-782"></span><span class="anchor" id="line-783"></span><span class="anchor" id="line-784"></span><span class="anchor" id="line-785"></span><span class="anchor" id="line-1-81"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_2"></span><span class="anchor" id="line-2-31"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_3"></span><span class="anchor" id="line-3-28"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_4"></span><span class="anchor" id="line-4-19"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.job</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">JobNotification</span>, <span class="ID">JobSchedule</span></span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_5"></span><span class="anchor" id="line-5-18"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_6"></span><span class="anchor" id="line-6-16"></span><span class="ID">jobRef</span> = <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">startReboot</span>([<span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">112640001</span>)],</span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_7"></span><span class="anchor" id="line-7-11"></span>                                             <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Immediate Reboot</span><span class="String" style="color: rgb(0, 64, 128);">"</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_8"></span><span class="anchor" id="line-8-11"></span>                                             <span class="ID">JobNotification</span>(),</span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_9"></span><span class="anchor" id="line-9-9"></span>                                             <span class="ID">JobSchedule</span>())</span>
<span class="line"><span class="LineAnchor" id="CA-af9d97d7c098ba716c0ee66a917e01c2444edc84_10"></span><span class="anchor" id="line-10-8"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="ID">jobRef</span></span>
</pre></div></div><span class="anchor" id="line-786" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution<span class="anchor" id="line-787"></span><span class="anchor" id="line-788"></span><span class="anchor" id="line-789"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-14"></span>Reboot Servers (JobRef:143820001)</pre><span class="anchor" id="line-790" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-791" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Assign_a_customer" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Assign a customer</h2><span class="anchor" id="line-792" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-793" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The GUI interface does not provide a mechanism to bulk assign a customer to a list of servers. This can be easily automated with pytwist.&nbsp;<span class="anchor" id="line-794"></span>Locate all servers that belong to the customer&nbsp;<strong>not assigned</strong>&nbsp;and move them to the customer&nbsp;<strong>Mr Red</strong>.<span class="anchor" id="line-795"></span><span class="anchor" id="line-796"></span><span class="anchor" id="line-797"></span><span class="anchor" id="line-798"></span><span class="anchor" id="line-799"></span><span class="anchor" id="line-800"></span><span class="anchor" id="line-801"></span><span class="anchor" id="line-802"></span><span class="anchor" id="line-803"></span><span class="anchor" id="line-804"></span><span class="anchor" id="line-805"></span><span class="anchor" id="line-806"></span><span class="anchor" id="line-807"></span><span class="anchor" id="line-1-83"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-7899932aa39414c85b5be4e43102616345c684d6" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_2"></span><span class="anchor" id="line-2-32"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_3"></span><span class="anchor" id="line-3-29"></span></span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_4"></span><span class="anchor" id="line-4-20"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_5"></span><span class="anchor" id="line-5-19"></span><span class="ID">findObjRefs</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span>.<span class="ID">findObjRefs</span></span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_6"></span><span class="anchor" id="line-6-17"></span><span class="ID">serverRefs</span> = <span class="ID">findObjRefs</span> (<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">device_customer_displayname = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Not Assigned</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">device</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_7"></span><span class="anchor" id="line-7-12"></span><span class="Comment" style="color: rgb(0, 128, 0);"># Matches one only customer.</span></span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_8"></span><span class="anchor" id="line-8-12"></span><span class="ID">customerRefs</span> = <span class="ID">findObjRefs</span> (<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">CustomerVO.displayName = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Mr Red</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">customer</span><span class="String" style="color: rgb(0, 64, 128);">'</span>) </span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_9"></span><span class="anchor" id="line-9-10"></span><span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ID">serverRefs</span> <span class="ResWord" style="color: rgb(160, 0, 0);">and</span> <span class="ID">customerRefs</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_10"></span><span class="anchor" id="line-10-9"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">serverRef</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> <span class="ID">serverRefs</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-7899932aa39414c85b5be4e43102616345c684d6_11"></span><span class="anchor" id="line-11-6"></span>        <span class="ID">ts</span>.<span class="ID">server</span>.<span class="ID">ServerService</span>.<span class="ID">setCustomer</span>(<span class="ID">serverRef</span>, <span class="ID">customerRefs</span>[<span class="Number" style="color: rgb(0, 128, 192);">0</span>])</span></pre></div></div>