<html><p>The Twist JVM uses Garbage First (G1) garbage collection algorithm. When Twist is configured with large Java heaps (8GB or above) and the default G1 configuration, the garbagge collection might struggle to keep up with the application allocation rates under heavy load. This results in Full GC events that usually pause the application threads for longer than the target pause time of 1000ms. When G1 algorithm is used, Full GC events should be avoided as much as possible.</p>

<p>To optimize the G1 behavior, the following Twist configuration is recommended:</p>

<pre><code class="language-bash">GC_ARGS="-XX:+UseG1GC -XX:MaxGCPauseMillis=1000 -XX:+UnlockExperimentalVMOptions -XX:ConcGCThreads=&lt;ParallelGCThreads&gt; -XX:G1MixedGCCountTarget=4 -XX:G1OldCSetRegionThresholdPercent=20"</code></pre>

<p>To set these parameters, edit <code>/opt/opsware/twist/twist.sh</code> and update the definition of the "GC_ARGS" variable as above. In order to determine the value of&nbsp;<code>&lt;ParallelGCThreads&gt;</code> execute the following command:</p>

<pre><code class="language-bash"># /opt/opsware/openjdk/bin/java -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version 2&gt;/dev/null | grep ParallelGCThreads
     uint ParallelGCThreads                        = 10                                        {product} {default}</code></pre>

<p>In the above example the value of&nbsp;<code>&lt;ParallelGCThreads&gt;</code> is 10. This is the number of parallel garbage collection threads used by G1 GC. This number is determined by the JVM based on the number of available CPU cores on the machine. The same value should be used to set the&nbsp;<code>ConcGCThreads</code> parameter for the Twist JVM. <code>ConcGCThreads&nbsp;</code>controls the number of concurrent garbage collection threads used by G1 GC. With the default configuration, the JVM sets&nbsp;<code>ConcGCThreads</code>&nbsp;to a value lower than <code>ParallelGCThreads</code>. Increasing the value of&nbsp;<code>ConcGCThreads</code>&nbsp;helps in reducing the probability of a Full GC event under heavy load.</p>
</html>