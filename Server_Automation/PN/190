<p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">A server script represents a code blob that runs on a managed server. This service is used for the registration and management of server scripts within folders. It also provides means to invoke scripts on servers.<span class="anchor" id="line-1015"></span><span class="anchor" id="line-1016"></span></p><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Exporting_servers_scripts" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Exporting servers scripts</h2><span class="anchor" id="line-1017" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1018" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">This script will export all the source code for scripts that have been created. It demonstrates the use of;&nbsp;<tt class="backtick"></tt><tt class="backtick">findServerScriptRefs,&nbsp;getServerScriptVOs,&nbsp;getSource</tt><tt class="backtick"></tt>&nbsp;along with various attributes of the ServerScriptVO object.<span class="anchor" id="line-1019"></span><span class="anchor" id="line-1020"></span><span class="anchor" id="line-1021"></span><span class="anchor" id="line-1022"></span><span class="anchor" id="line-1023"></span><span class="anchor" id="line-1024"></span><span class="anchor" id="line-1025"></span><span class="anchor" id="line-1026"></span><span class="anchor" id="line-1027"></span><span class="anchor" id="line-1028"></span><span class="anchor" id="line-1029"></span><span class="anchor" id="line-1030"></span><span class="anchor" id="line-1031"></span><span class="anchor" id="line-1032"></span><span class="anchor" id="line-1-103"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_2"></span><span class="anchor" id="line-2-40"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_3"></span><span class="anchor" id="line-3-36"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.search</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">Filter</span></span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_4"></span><span class="anchor" id="line-4-27"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_5"></span><span class="anchor" id="line-5-26"></span><span class="ID">SS</span> = <span class="ID">ts</span>.<span class="ID">script</span>.<span class="ID">ServerScriptService</span></span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_6"></span><span class="anchor" id="line-6-24"></span><span class="ID">refs</span> = <span class="ID">SS</span>.<span class="ID">findServerScriptRefs</span>(<span class="ID">Filter</span>())</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_7"></span><span class="anchor" id="line-7-19"></span><span class="ID">camelCase</span> = <span class="ResWord" style="color: rgb(160, 0, 0);">lambda</span> <span class="ID">s</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">'</span>.<span class="ID">join</span>(<span class="ID">x</span> <span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">x</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> <span class="ID">s</span>.<span class="ID">title</span>() <span class="ResWord" style="color: rgb(160, 0, 0);">if</span> <span class="ResWord" style="color: rgb(160, 0, 0);">not</span> <span class="ID">x</span>.<span class="ID">isspace</span>())</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_8"></span><span class="anchor" id="line-8-19"></span><span class="ResWord" style="color: rgb(160, 0, 0);">for</span> <span class="ID">vo</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> <span class="ID">SS</span>.<span class="ID">getServerScriptVOs</span>(<span class="ID">refs</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_9"></span><span class="anchor" id="line-9-16"></span>    <span class="ID">filename</span> = <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">.</span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> %(<span class="ID">camelCase</span>(<span class="ID">vo</span>.<span class="ID">name</span>),<span class="ID">vo</span>.<span class="ID">codeType</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_10"></span><span class="anchor" id="line-10-15"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Exporting </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">filename</span></span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_11"></span><span class="anchor" id="line-11-12"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">with</span> <span class="ResWord" style="color: rgb(160, 0, 0);">open</span>(<span class="ID">filename</span>,<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">w</span><span class="String" style="color: rgb(0, 64, 128);">'</span>) <span class="ResWord" style="color: rgb(160, 0, 0);">as</span> <span class="ID">f</span>:</span>
<span class="line"><span class="LineAnchor" id="CA-0cddbe5201333995699ac9bb36ca3008cc67514f_12"></span><span class="anchor" id="line-12-11"></span>        <span class="ID">f</span>.<span class="ID">write</span>(<span class="ID">SS</span>.<span class="ID">getSource</span>(<span class="ID">vo</span>.<span class="ID">ref</span>, <span class="ID">vo</span>.<span class="ID">currentVersion</span>.<span class="ID">versionLabel</span>))</span>
</pre></div></div><span class="anchor" id="line-1033" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1034" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Scheduling_a_server_script_against_servers" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Scheduling a server script against servers</h2><span class="anchor" id="line-1035" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1036" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">This is jumping ahead a little as we need to deal with some objects related to Job creation but its as good a time as any to introduce this topic. Our objective is to programmatically schedule a server script to run against a batch of servers that match a filter condition. Error handling has been left out to improve readability.<span class="anchor" id="line-1037"></span><span class="anchor" id="line-1038"></span><span class="anchor" id="line-1039"></span><span class="anchor" id="line-1040"></span><span class="anchor" id="line-1041"></span><span class="anchor" id="line-1042"></span><span class="anchor" id="line-1043"></span><span class="anchor" id="line-1044"></span><span class="anchor" id="line-1045"></span><span class="anchor" id="line-1046"></span><span class="anchor" id="line-1047"></span><span class="anchor" id="line-1048"></span><span class="anchor" id="line-1049"></span><span class="anchor" id="line-1050"></span><span class="anchor" id="line-1051"></span><span class="anchor" id="line-1052"></span><span class="anchor" id="line-1053"></span><span class="anchor" id="line-1054"></span><span class="anchor" id="line-1055"></span><span class="anchor" id="line-1056"></span><span class="anchor" id="line-1057"></span><span class="anchor" id="line-1058"></span><span class="anchor" id="line-1059"></span><span class="anchor" id="line-1060"></span><span class="anchor" id="line-1061"></span><span class="anchor" id="line-1062"></span><span class="anchor" id="line-1063"></span><span class="anchor" id="line-1064"></span><span class="anchor" id="line-1065"></span><span class="anchor" id="line-1066"></span><span class="anchor" id="line-1067"></span><span class="anchor" id="line-1068"></span><span class="anchor" id="line-1069"></span><span class="anchor" id="line-1070"></span><span class="anchor" id="line-1071"></span><span class="anchor" id="line-1-105"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_2"></span><span class="anchor" id="line-2-41"></span><span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">time</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_3"></span><span class="anchor" id="line-3-37"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_4"></span><span class="anchor" id="line-4-28"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.job</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">JobNotification</span>, <span class="ID">JobSchedule</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_5"></span><span class="anchor" id="line-5-27"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.script</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerScriptJobArgs</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_6"></span><span class="anchor" id="line-6-25"></span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_7"></span><span class="anchor" id="line-7-20"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_8"></span><span class="anchor" id="line-8-20"></span><span class="ID">ts</span>.<span class="ID">authenticate</span>(<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">user</span><span class="String" style="color: rgb(0, 64, 128);">"</span>,<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">"</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_9"></span><span class="anchor" id="line-9-17"></span><span class="ID">ServerScriptService</span> = <span class="ID">ts</span>.<span class="ID">script</span>.<span class="ID">ServerScriptService</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_10"></span><span class="anchor" id="line-10-16"></span><span class="ID">SearchService</span> = <span class="ID">ts</span>.<span class="ID">search</span>.<span class="ID">SearchService</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_11"></span><span class="anchor" id="line-11-13"></span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_12"></span><span class="anchor" id="line-12-12"></span><span class="ID">email</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">jyaya@yoyodyne.com</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_13"></span><span class="anchor" id="line-13-11"></span><span class="ID">jobNotification</span> = <span class="ID">JobNotification</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_14"></span><span class="anchor" id="line-14-11"></span><span class="ID">jobNotification</span>.<span class="ID">onCancelRecipients</span>=[<span class="ID">email</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_15"></span><span class="anchor" id="line-15-10"></span><span class="ID">jobNotification</span>.<span class="ID">onFailureRecipients</span>=[<span class="ID">email</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_16"></span><span class="anchor" id="line-16-9"></span><span class="ID">jobNotification</span>.<span class="ID">onSuccessRecipients</span>=[<span class="ID">email</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_17"></span><span class="anchor" id="line-17-9"></span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_18"></span><span class="anchor" id="line-18-9"></span><span class="ID">jobSchedule</span> = <span class="ID">JobSchedule</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_19"></span><span class="anchor" id="line-19-7"></span><span class="ID">jobSchedule</span>.<span class="ID">startDate</span> = <span class="ResWord" style="color: rgb(160, 0, 0);">long</span>(<span class="ID">time</span>.<span class="ID">time</span>() + <span class="Number" style="color: rgb(0, 128, 192);">60</span>) <span class="Comment" style="color: rgb(0, 128, 0);">#  1 min from now</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_20"></span><span class="anchor" id="line-20-7"></span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_21"></span><span class="anchor" id="line-21-7"></span><span class="ID">args</span> = <span class="ID">ServerScriptJobArgs</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_22"></span><span class="anchor" id="line-22-5"></span><span class="ID">args</span>.<span class="ID">timeOut</span> = <span class="Number" style="color: rgb(0, 128, 192);">4</span> * <span class="Number" style="color: rgb(0, 128, 192);">60</span> <span class="Comment" style="color: rgb(0, 128, 0);"># seconds</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_23"></span><span class="anchor" id="line-23-5"></span><span class="ID">args</span>.<span class="ID">targets</span> = <span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_24"></span><span class="anchor" id="line-24-4"></span>        <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">device_management_ip BEGINS_WITH 10.0</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_25"></span><span class="anchor" id="line-25-4"></span>        <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">device</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_26"></span><span class="anchor" id="line-26-2"></span><span class="ID">scriptRef</span> = <span class="ID">SearchService</span>.<span class="ID">findObjRefs</span>(</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_27"></span><span class="anchor" id="line-27-2"></span>        <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ServerScriptVO.name = </span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Sleeping Server Script</span><span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_28"></span><span class="anchor" id="line-28-2"></span>        <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">server_script</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)[<span class="Number" style="color: rgb(0, 128, 192);">0</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_29"></span><span class="anchor" id="line-29-2"></span><span class="ID">userTag</span> = <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">run script on servers</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_30"></span><span class="anchor" id="line-30-2"></span></span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_31"></span><span class="anchor" id="line-31-2"></span><span class="ID">jobRef</span> = <span class="ID">ServerScriptService</span>.<span class="ID">startServerScript</span>(<span class="ID">scriptRef</span>, <span class="ID">args</span>, <span class="ID">userTag</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_32"></span><span class="anchor" id="line-32-2"></span>                                               <span class="ID">jobNotification</span>, <span class="ID">jobSchedule</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-378f37b5838f12514c173b2bef9dc687660cdc09_33"></span><span class="anchor" id="line-33-2"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Created job </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobRef</span></span>
</pre></div></div><span class="anchor" id="line-1072" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution:<span class="anchor" id="line-1073"></span><span class="anchor" id="line-1074"></span><span class="anchor" id="line-1075"></span><span class="anchor" id="line-1076"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-17"></span>[root@dc1 demo]# ./run-script.py
<span class="anchor" id="line-2-15"></span>Created job Run Server Script (ScheduledJobRef:114110001)</pre><span class="anchor" id="line-1077" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The call to&nbsp;<tt class="backtick"></tt><tt class="backtick">startServerScript</tt><tt class="backtick"></tt>&nbsp;is asynchronous, that is once the job has been submitted the python program will resume control whilst the SA deals with the execution of the submitted job, either immediately or in the future as we have scheduled it.<span class="anchor" id="line-1078"></span><span class="anchor" id="line-1079"></span></p><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Normally the&nbsp;<tt class="backtick"></tt><tt class="backtick">startDate</tt><tt class="backtick"></tt>&nbsp;is not a relative offset but some absolute point in time when you want the job to run. To convert absolute date/time to an epoch number suitable for supplying to&nbsp;<tt class="backtick"></tt><tt class="backtick">startDate</tt><tt class="backtick"></tt>&nbsp;this calculation is handy:<span class="anchor" id="line-1080"></span><span class="anchor" id="line-1081"></span><span class="anchor" id="line-1082"></span><span class="anchor" id="line-1083"></span><span class="anchor" id="line-1084"></span><span class="anchor" id="line-1085"></span><span class="anchor" id="line-1086"></span><span class="anchor" id="line-1087"></span><span class="anchor" id="line-1088"></span><span class="anchor" id="line-1-107"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line">&gt;&gt;&gt; <span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">datetime</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">datetime</span></span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_2"></span><span class="anchor" id="line-2-42"></span>&gt;&gt;&gt; (<span class="ID">datetime</span>(<span class="Number" style="color: rgb(0, 128, 192);">2019</span>,<span class="Number" style="color: rgb(0, 128, 192);">12</span>,<span class="Number" style="color: rgb(0, 128, 192);">1</span>,<span class="Number" style="color: rgb(0, 128, 192);">16</span>,<span class="Number" style="color: rgb(0, 128, 192);">43</span>,<span class="Number" style="color: rgb(0, 128, 192);">45</span>)-<span class="ID">datetime</span>(<span class="Number" style="color: rgb(0, 128, 192);">1970</span>,<span class="Number" style="color: rgb(0, 128, 192);">1</span>,<span class="Number" style="color: rgb(0, 128, 192);">1</span>)).<span class="ID">total_seconds</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_3"></span><span class="anchor" id="line-3-38"></span><span class="Number" style="color: rgb(0, 128, 192);">1575218625.0</span></span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_4"></span><span class="anchor" id="line-4-29"></span>&gt;&gt;&gt; <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">time</span></span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_5"></span><span class="anchor" id="line-5-28"></span>&gt;&gt;&gt; <span class="ID">time</span>.<span class="ID">ctime</span>(<span class="Number" style="color: rgb(0, 128, 192);">1575218625</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_6"></span><span class="anchor" id="line-6-26"></span><span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">Sun Dec  1 16:43:45 2019</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-3c7ed184b9292403686b0a7ec7d1b970009edfa2_7"></span><span class="anchor" id="line-7-21"></span>&gt;&gt;&gt;</span>
</pre></div></div><span class="anchor" id="line-1089" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1090" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Running_an_adHoc_script" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Running an adHoc script</h2><span class="anchor" id="line-1091" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1092" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Paring down to the bare essentials we can submit and adHoc shell script to execute against a Linux server to run immediately without any notification.<span class="anchor" id="line-1093"></span><span class="anchor" id="line-1094"></span><span class="anchor" id="line-1095"></span><span class="anchor" id="line-1096"></span><span class="anchor" id="line-1097"></span><span class="anchor" id="line-1098"></span><span class="anchor" id="line-1099"></span><span class="anchor" id="line-1100"></span><span class="anchor" id="line-1101"></span><span class="anchor" id="line-1102"></span><span class="anchor" id="line-1103"></span><span class="anchor" id="line-1104"></span><span class="anchor" id="line-1105"></span><span class="anchor" id="line-1106"></span><span class="anchor" id="line-1107"></span><span class="anchor" id="line-1108"></span><span class="anchor" id="line-1109"></span><span class="anchor" id="line-1110"></span><span class="anchor" id="line-1111"></span><span class="anchor" id="line-1112"></span><span class="anchor" id="line-1113"></span><span class="anchor" id="line-1114"></span><span class="anchor" id="line-1-109"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="Comment" style="color: rgb(0, 128, 0);">#!/opt/opsware/bin/python</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_2"></span><span class="anchor" id="line-2-43"></span><span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">time</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_3"></span><span class="anchor" id="line-3-39"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_4"></span><span class="anchor" id="line-4-30"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.script</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerScriptJobArgs</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_5"></span><span class="anchor" id="line-5-29"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_6"></span><span class="anchor" id="line-6-27"></span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_7"></span><span class="anchor" id="line-7-22"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_8"></span><span class="anchor" id="line-8-21"></span><span class="ID">ts</span>.<span class="ID">authenticate</span>(<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">user</span><span class="String" style="color: rgb(0, 64, 128);">"</span>,<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">"</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_9"></span><span class="anchor" id="line-9-18"></span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_10"></span><span class="anchor" id="line-10-17"></span><span class="ID">args</span> = <span class="ID">ServerScriptJobArgs</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_11"></span><span class="anchor" id="line-11-14"></span><span class="ID">args</span>.<span class="ID">targets</span> = [<span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">91190001</span>)]</span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_12"></span><span class="anchor" id="line-12-13"></span><span class="ID">args</span>.<span class="ID">tailOutputSize</span> = <span class="Number" style="color: rgb(0, 128, 192);">10</span> * <span class="Number" style="color: rgb(0, 128, 192);">1024</span> <span class="Comment" style="color: rgb(0, 128, 0);"># 10k</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_13"></span><span class="anchor" id="line-13-12"></span><span class="ID">args</span>.<span class="ID">timeOut</span> = <span class="Number" style="color: rgb(0, 128, 192);">600</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_14"></span><span class="anchor" id="line-14-12"></span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_15"></span><span class="anchor" id="line-15-11"></span><span class="ID">userTag</span> = <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">adHoc script</span><span class="String" style="color: rgb(0, 64, 128);">"</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_16"></span><span class="anchor" id="line-16-10"></span><span class="ID">source</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">echo hello world</span><span class="SPChar" style="color: rgb(0, 0, 192);">\n</span><span class="String" style="color: rgb(0, 64, 128);">echo adhoc script here</span><span class="SPChar" style="color: rgb(0, 0, 192);">\n</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_17"></span><span class="anchor" id="line-17-10"></span><span class="ID">codeType</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">SH</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_18"></span><span class="anchor" id="line-18-10"></span></span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_19"></span><span class="anchor" id="line-19-8"></span><span class="ID">jobRef</span> = <span class="ID">ts</span>.<span class="ID">script</span>.<span class="ID">ServerScriptService</span>.<span class="ID">startAdhocServerScript</span>(<span class="ID">source</span>, <span class="ID">codeType</span>, <span class="ID">args</span>, <span class="ID">userTag</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">None</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">None</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-1fc6c89020c2ae378056c7c2efd0215fb0aeabae_20"></span><span class="anchor" id="line-20-8"></span><span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Created job </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobRef</span></span>
</pre></div></div><span class="anchor" id="line-1115" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1116" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line867" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;"></p><h2 id="Running_an_adHoc_script_synchronously_and_obtaining_results" style="color: rgb(0, 0, 0); letter-spacing: normal; text-transform: none; font-family: sans-serif;">Running an adHoc script synchronously and obtaining results</h2><span class="anchor" id="line-1117" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1118" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">As the job execution engine (Way) is executing the job asynchronously if we want to get the results in the same script we'll need to wait for the job to finish. This will require polling the job and waiting for either FAILURE or SUCCESS. The job return status is a numeric so we need a mapping table.<span class="anchor" id="line-1119"></span><span class="anchor" id="line-1120"></span><span class="anchor" id="line-1121"></span><span class="anchor" id="line-1122"></span><span class="anchor" id="line-1123"></span><span class="anchor" id="line-1124"></span><span class="anchor" id="line-1125"></span><span class="anchor" id="line-1126"></span><span class="anchor" id="line-1127"></span><span class="anchor" id="line-1128"></span><span class="anchor" id="line-1129"></span><span class="anchor" id="line-1130"></span><span class="anchor" id="line-1131"></span><span class="anchor" id="line-1132"></span><span class="anchor" id="line-1133"></span><span class="anchor" id="line-1134"></span><span class="anchor" id="line-1135"></span><span class="anchor" id="line-1136"></span><span class="anchor" id="line-1137"></span><span class="anchor" id="line-1138"></span><span class="anchor" id="line-1139"></span><span class="anchor" id="line-1140"></span><span class="anchor" id="line-1141"></span><span class="anchor" id="line-1142"></span><span class="anchor" id="line-1143"></span><span class="anchor" id="line-1144"></span><span class="anchor" id="line-1145"></span><span class="anchor" id="line-1146"></span><span class="anchor" id="line-1147"></span><span class="anchor" id="line-1148"></span><span class="anchor" id="line-1149"></span><span class="anchor" id="line-1150"></span><span class="anchor" id="line-1151"></span><span class="anchor" id="line-1152"></span><span class="anchor" id="line-1153"></span><span class="anchor" id="line-1154"></span><span class="anchor" id="line-1155"></span><span class="anchor" id="line-1156"></span><span class="anchor" id="line-1157"></span><span class="anchor" id="line-1158"></span><span class="anchor" id="line-1159"></span><span class="anchor" id="line-1160"></span><span class="anchor" id="line-1161"></span><span class="anchor" id="line-1162"></span><span class="anchor" id="line-1163"></span><span class="anchor" id="line-1164"></span><span class="anchor" id="line-1165"></span><span class="anchor" id="line-1166"></span><span class="anchor" id="line-1167"></span><span class="anchor" id="line-1168"></span><span class="anchor" id="line-1169"></span><span class="anchor" id="line-1170"></span><span class="anchor" id="line-1171"></span><span class="anchor" id="line-1172"></span><span class="anchor" id="line-1173"></span><span class="anchor" id="line-1174"></span><span class="anchor" id="line-1-111"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">sys</span>, <span class="ID">time</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_2"></span><span class="anchor" id="line-2-44"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">twistserver</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_3"></span><span class="anchor" id="line-3-40"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.script</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerScriptJobArgs</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_4"></span><span class="anchor" id="line-4-31"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.job</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">JobInfoVO</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_5"></span><span class="anchor" id="line-5-30"></span><span class="ResWord" style="color: rgb(160, 0, 0);">from</span> <span class="ID">pytwist.com.opsware.server</span> <span class="ResWord" style="color: rgb(160, 0, 0);">import</span> <span class="ID">ServerRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_6"></span><span class="anchor" id="line-6-28"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_7"></span><span class="anchor" id="line-7-23"></span><span class="ID">jobStatus</span> = {</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_8"></span><span class="anchor" id="line-8-22"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_ABORTED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ABORTED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,   <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_ACTIVE</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ACTIVE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_9"></span><span class="anchor" id="line-9-19"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_BLOCKED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">BLOCKED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,   <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_CANCELLED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">CANCELLED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_10"></span><span class="anchor" id="line-10-18"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_DELETED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">DELETED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,   <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_EXPIRED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">EXPIRED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_11"></span><span class="anchor" id="line-11-15"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_FAILURE</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">FAILURE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,   <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_PENDING</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">PENDING</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_12"></span><span class="anchor" id="line-12-14"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_RECURRING</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">RECURRING</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_13"></span><span class="anchor" id="line-13-13"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_STALE</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">STALE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,       <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_SUCCESS</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">SUCCESS</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_14"></span><span class="anchor" id="line-14-13"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_TAMPERED</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">TAMPERED</span><span class="String" style="color: rgb(0, 64, 128);">'</span>, <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_UNKNOWN</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">UNKNOWN</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_15"></span><span class="anchor" id="line-15-12"></span>  <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_WARNING</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">WARNING</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,   <span class="ID">JobInfoVO</span>.<span class="ID">STATUS_ZOMBIE</span>: <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">ZOMBIE</span><span class="String" style="color: rgb(0, 64, 128);">'</span>}</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_16"></span><span class="anchor" id="line-16-11"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_17"></span><span class="anchor" id="line-17-11"></span><span class="ID">ts</span> = <span class="ID">twistserver</span>.<span class="ID">TwistServer</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_18"></span><span class="anchor" id="line-18-11"></span><span class="ID">ts</span>.<span class="ID">authenticate</span>(<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">user</span><span class="String" style="color: rgb(0, 64, 128);">"</span>,<span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">password</span><span class="String" style="color: rgb(0, 64, 128);">"</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_19"></span><span class="anchor" id="line-19-9"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_20"></span><span class="anchor" id="line-20-9"></span><span class="ID">ServerScriptService</span> = <span class="ID">ts</span>.<span class="ID">script</span>.<span class="ID">ServerScriptService</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_21"></span><span class="anchor" id="line-21-8"></span><span class="ID">JobService</span> = <span class="ID">ts</span>.<span class="ID">job</span>.<span class="ID">JobService</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_22"></span><span class="anchor" id="line-22-6"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_23"></span><span class="anchor" id="line-23-6"></span><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">runAdHocScript</span>(<span class="ID">serverRef</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_24"></span><span class="anchor" id="line-24-5"></span>    <span class="ID">args</span> = <span class="ID">ServerScriptJobArgs</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_25"></span><span class="anchor" id="line-25-5"></span>    <span class="ID">args</span>.<span class="ID">targets</span> = [<span class="ID">serverRef</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_26"></span><span class="anchor" id="line-26-3"></span>    <span class="ID">source</span> = <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">echo hello world</span><span class="SPChar" style="color: rgb(0, 0, 192);">\n</span><span class="String" style="color: rgb(0, 64, 128);">echo adhoc script here</span><span class="String" style="color: rgb(0, 64, 128);">'</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_27"></span><span class="anchor" id="line-27-3"></span>    <span class="ID">jobRef</span> = <span class="ID">ServerScriptService</span>.<span class="ID">startAdhocServerScript</span>(<span class="ID">source</span>, <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">SH</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_28"></span><span class="anchor" id="line-28-3"></span>                                                        <span class="ID">args</span>, <span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">adHoc Script</span><span class="String" style="color: rgb(0, 64, 128);">'</span>,</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_29"></span><span class="anchor" id="line-29-3"></span>                                                        <span class="ResWord" style="color: rgb(160, 0, 0);">None</span>, <span class="ResWord" style="color: rgb(160, 0, 0);">None</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_30"></span><span class="anchor" id="line-30-3"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Created job </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_31"></span><span class="anchor" id="line-31-3"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">return</span> <span class="ID">jobRef</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_32"></span><span class="anchor" id="line-32-3"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_33"></span><span class="anchor" id="line-33-3"></span><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">waitForJobToFinish</span>(<span class="ID">jobRef</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_34"></span><span class="anchor" id="line-34-1"></span>    <span class="ID">jobvo</span> = <span class="ID">JobService</span>.<span class="ID">getJobInfoVO</span>(<span class="ID">jobRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_35"></span><span class="anchor" id="line-35-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">while</span> <span class="ID">jobvo</span>.<span class="ID">status</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> (<span class="ID">JobInfoVO</span>.<span class="ID">STATUS_ACTIVE</span>,<span class="ID">JobInfoVO</span>.<span class="ID">STATUS_PENDING</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_36"></span><span class="anchor" id="line-36-1"></span>        <span class="ID">sys</span>.<span class="ID">stdout</span>.<span class="ID">write</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="String" style="color: rgb(0, 64, 128);">.</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_37"></span><span class="anchor" id="line-37-1"></span>        <span class="ID">sys</span>.<span class="ID">stdout</span>.<span class="ID">flush</span>()</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_38"></span><span class="anchor" id="line-38-1"></span>        <span class="ID">time</span>.<span class="ID">sleep</span>(<span class="Number" style="color: rgb(0, 128, 192);">2</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_39"></span><span class="anchor" id="line-39-1"></span>        <span class="ID">jobvo</span> = <span class="ID">JobService</span>.<span class="ID">getJobInfoVO</span>(<span class="ID">jobRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_40"></span><span class="anchor" id="line-40-1"></span>    <span class="ID">sys</span>.<span class="ID">stdout</span>.<span class="ID">write</span>(<span class="String" style="color: rgb(0, 64, 128);">'</span><span class="SPChar" style="color: rgb(0, 0, 192);">\n</span><span class="String" style="color: rgb(0, 64, 128);">'</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_41"></span><span class="anchor" id="line-41-1"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_42"></span><span class="anchor" id="line-42-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">End: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">time</span>.<span class="ID">ctime</span>(<span class="ID">jobvo</span>.<span class="ID">endDate</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_43"></span><span class="anchor" id="line-43-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">Job status: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobStatus</span>[<span class="ID">jobvo</span>.<span class="ID">status</span>]</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_44"></span><span class="anchor" id="line-44-1"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_45"></span><span class="anchor" id="line-45-1"></span><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">displayJobResults</span>(<span class="ID">jobRef</span>, <span class="ID">serverRef</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_46"></span><span class="anchor" id="line-46-1"></span>    <span class="ID">jobOutput</span> = <span class="ID">ServerScriptService</span>.<span class="ID">getServerScriptJobOutput</span>(<span class="ID">jobRef</span>, <span class="ID">serverRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_47"></span><span class="anchor" id="line-47-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">exit code: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobOutput</span>.<span class="ID">exitCode</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_48"></span><span class="anchor" id="line-48-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">stderr: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobOutput</span>.<span class="ID">tailStderr</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_49"></span><span class="anchor" id="line-49-1"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">print</span> <span class="String" style="color: rgb(0, 64, 128);">"</span><span class="String" style="color: rgb(0, 64, 128);">stdout: </span><span class="String" style="color: rgb(0, 64, 128);">%s</span><span class="String" style="color: rgb(0, 64, 128);">"</span> % <span class="ID">jobOutput</span>.<span class="ID">tailStdout</span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_50"></span><span class="anchor" id="line-50-1"></span></span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_51"></span><span class="anchor" id="line-51-1"></span><span class="ID">myServer</span> = <span class="ID">ServerRef</span>(<span class="Number" style="color: rgb(0, 128, 192);">91190001</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_52"></span><span class="anchor" id="line-52-1"></span><span class="ID">job</span> = <span class="ID">runAdHocScript</span>(<span class="ID">myServer</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_53"></span><span class="anchor" id="line-53-1"></span><span class="ID">waitForJobToFinish</span>(<span class="ID">job</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-a0cf58849049b62c000f8ea54a7062d2050bec9c_54"></span><span class="anchor" id="line-54-1"></span><span class="ID">displayJobResults</span>(<span class="ID">job</span>, <span class="ID">myServer</span>)</span>
</pre></div></div><span class="anchor" id="line-1175" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">An neat trick using dictionary comprehension available in python 2.7 and class introspection to setup the jobStatus translation map that we defined manually.<span class="anchor" id="line-1176"></span><span class="anchor" id="line-1177"></span><span class="anchor" id="line-1178"></span><span class="anchor" id="line-1179"></span><span class="anchor" id="line-1180"></span><span class="anchor" id="line-1181"></span><span class="anchor" id="line-1182"></span><span class="anchor" id="line-1183"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-18"></span>&gt;&gt;&gt; jobStatus = {v: k.replace('STATUS_','')
<span class="anchor" id="line-2-16"></span>...              for k,v in vars(JobInfoVO).items()
<span class="anchor" id="line-3-10"></span>...              if not callable(v) and k.startswith('STATUS_')}
<span class="anchor" id="line-4-7"></span>&gt;&gt;&gt; jobStatus
<span class="anchor" id="line-5-5"></span>{0: 'ABORTED', 1: 'ACTIVE', 2: 'CANCELLED', 3: 'DELETED', 4: 'FAILURE', 5: 'PENDING', 6: 'SUCCESS', 7: 'UNKNOWN', 8: 'WARNING', 9: 'TAMPERED', 10: 'STALE', 11: 'BLOCKED', 12: 'RECURRING', 13: 'EXPIRED', 14: 'ZOMBIE', 15: 'TERMINATING', 16: 'TERMINATED'}
<span class="anchor" id="line-6-5"></span>&gt;&gt;&gt;</pre><span class="anchor" id="line-1184" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Execution of the script<span class="anchor" id="line-1185"></span><span class="anchor" id="line-1186"></span><span class="anchor" id="line-1187"></span><span class="anchor" id="line-1188"></span><span class="anchor" id="line-1189"></span><span class="anchor" id="line-1190"></span><span class="anchor" id="line-1191"></span><span class="anchor" id="line-1192"></span><span class="anchor" id="line-1193"></span><span class="anchor" id="line-1194"></span><span class="anchor" id="line-1195"></span></p><pre style="color: rgb(0, 0, 0); border-width: 1pt; border-style: solid; border-color: rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="anchor" id="line-1-19"></span>[root@dc1 ServerScriptService]# ./run-adhoc-script-sync.py
<span class="anchor" id="line-2-17"></span>Created job Run Server Script (JobRef:114220001)
<span class="anchor" id="line-3-11"></span>..
<span class="anchor" id="line-4-8"></span>End: Fri Oct  4 12:27:25 2019
<span class="anchor" id="line-5-6"></span>Job status: SUCCESS
<span class="anchor" id="line-6-6"></span>exit code: 0
<span class="anchor" id="line-7-5"></span>stderr:
<span class="anchor" id="line-8-5"></span>stdout: hello world
<span class="anchor" id="line-9-3"></span>adhoc script here</pre><span class="anchor" id="line-1196" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">What is wrong with this code is that the polling loop waiting for the job to finish is iterating every 2 seconds. This creates a scalability issue and is ok for a demo but in production you should only poll a minimum of once every 60 second. Even that does not scale well. A better solution is to use the use the EventCacheService.<span class="anchor" id="line-1197"></span><span class="anchor" id="line-1198"></span></p><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Why does is job polling this way perform badly? Its due to the fact that the call&nbsp;<tt class="backtick"></tt><tt class="backtick">getJobInfo()</tt><tt class="backtick"></tt>&nbsp;is a heavy call that exerts load upon the Twist.<span class="anchor" id="line-1199"></span><span class="anchor" id="line-1200"></span></p><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The reason it's a heavy is due to this structure being populated.<span class="anchor" id="line-1201"></span><span class="anchor" id="line-1202"></span><span class="anchor" id="line-1203"></span><span class="anchor" id="line-1204"></span><span class="anchor" id="line-1205"></span><span class="anchor" id="line-1206"></span><span class="anchor" id="line-1207"></span><span class="anchor" id="line-1208"></span><span class="anchor" id="line-1209"></span><span class="anchor" id="line-1210"></span><span class="anchor" id="line-1-113"></span></p><img src="./mediawiki/images/PN/graphviz4138907836451724440.png"><br><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">The primary issue being the JobServerInfo. For large server jobs populating this array when all we require is the job status is what causes problems.<span class="anchor" id="line-1212"></span><span class="anchor" id="line-1213"></span></p><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">You may think perhaps using&nbsp;<tt class="backtick"></tt><tt class="backtick">getProgress()</tt><tt class="backtick"></tt>&nbsp;method would be lighter but it still has to populate the&nbsp;<tt class="backtick"></tt><tt class="backtick">JobInfoVO</tt><tt class="backtick"></tt>&nbsp;and it too suffers the same performance issue.<span class="anchor" id="line-1214"></span><span class="anchor" id="line-1215"></span><span class="anchor" id="line-1216"></span><span class="anchor" id="line-1217"></span><span class="anchor" id="line-1218"></span><span class="anchor" id="line-1219"></span><span class="anchor" id="line-1220"></span><span class="anchor" id="line-1221"></span><span class="anchor" id="line-1222"></span><span class="anchor" id="line-1-114"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line"><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">jobIsInProgress</span>(<span class="ID">job_ref</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_2"></span><span class="anchor" id="line-2-45"></span>        <span class="ID">job_progress</span> = <span class="ID">ts</span>.<span class="ID">job</span>.<span class="ID">JobService</span>.<span class="ID">getProgress</span>(<span class="ID">job_ref</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_3"></span><span class="anchor" id="line-3-41"></span>        <span class="ResWord" style="color: rgb(160, 0, 0);">return</span> <span class="ID">job_progress</span> <span class="ResWord" style="color: rgb(160, 0, 0);">and</span> (<span class="ID">job_progress</span>.<span class="ID">active</span> == <span class="Number" style="color: rgb(0, 128, 192);">1</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_4"></span><span class="anchor" id="line-4-32"></span></span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_5"></span><span class="anchor" id="line-5-31"></span><span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">waitForJobToFinish</span>(<span class="ID">job_ref</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_6"></span><span class="anchor" id="line-6-29"></span>   <span class="ResWord" style="color: rgb(160, 0, 0);">while</span> <span class="ID">jobIsInProgress</span>(<span class="ID">job_ref</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-3cce8b15c343b511d4c26f5664da78c128aec204_7"></span><span class="anchor" id="line-7-24"></span>      <span class="ID">time</span>.<span class="ID">sleep</span>(<span class="Number" style="color: rgb(0, 128, 192);">60</span>)</span>
</pre></div></div><span class="anchor" id="line-1223" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1224" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line874" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">An enhancement request OCTCR19L333539 to create a new API that only fetches the job status is in development. In future SA releases we will be able to code<span class="anchor" id="line-1225"></span><span class="anchor" id="line-1226"></span><span class="anchor" id="line-1227"></span><span class="anchor" id="line-1228"></span><span class="anchor" id="line-1229"></span><span class="anchor" id="line-1230"></span><span class="anchor" id="line-1231"></span><span class="anchor" id="line-1-116"></span></p><div class="highlight python" style="color: rgb(0, 0, 0); font-family: sans-serif;"><div class="codearea" dir="ltr" lang="en" style="margin: 0.5em 0px; padding: 0px; border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247);"><pre dir="ltr" id="CA-4992c5777dd5e05aa78c798e0ffb99273f849066" lang="en" style="border-width: initial; border-style: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word;"><span class="line">  <span class="ResWord" style="color: rgb(160, 0, 0);">def</span> <span class="ID">waitForJobToFinish</span>(<span class="ID">jobRef</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-4992c5777dd5e05aa78c798e0ffb99273f849066_2"></span><span class="anchor" id="line-2-46"></span>    <span class="ID">status</span> = <span class="ID">JobService</span>.<span class="ID">getJobStatus</span>(<span class="ID">jobRef</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-4992c5777dd5e05aa78c798e0ffb99273f849066_3"></span><span class="anchor" id="line-3-42"></span>    <span class="ResWord" style="color: rgb(160, 0, 0);">while</span> <span class="ID">status</span> <span class="ResWord" style="color: rgb(160, 0, 0);">in</span> (<span class="ID">JobInfoVO</span>.<span class="ID">STATUS_ACTIVE</span>,<span class="ID">JobInfoVO</span>.<span class="ID">STATUS_PENDING</span>):</span>
<span class="line"><span class="LineAnchor" id="CA-4992c5777dd5e05aa78c798e0ffb99273f849066_4"></span><span class="anchor" id="line-4-33"></span>        <span class="ID">time</span>.<span class="ID">sleep</span>(<span class="Number" style="color: rgb(0, 128, 192);">60</span>)</span>
<span class="line"><span class="LineAnchor" id="CA-4992c5777dd5e05aa78c798e0ffb99273f849066_5"></span><span class="anchor" id="line-5-32"></span>        <span class="ID">status</span> = <span class="ID">JobService</span>.<span class="ID">getJobStatus</span>(<span class="ID">jobRef</span>)</span>
</pre></div></div><span class="anchor" id="line-1232" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><span class="anchor" id="line-1233" style="color: rgb(0, 0, 0); font-family: sans-serif;"></span><p class="line862" style="color: rgb(0, 0, 0); letter-spacing: normal; font-family: sans-serif; font-size: 16px;">Until this appears using the EventCacheService is the lightest call that can be made when polling for completion.</p>