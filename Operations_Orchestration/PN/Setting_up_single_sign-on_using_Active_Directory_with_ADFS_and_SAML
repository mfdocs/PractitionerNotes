<div><span style="background-color: transparent;"><br></span></div><div><span style="background-color: transparent;">Micro Focus Operations Orchestration supports sign-on (SSO) logins through SAML 2.0.</span><br></div><div>The most used SAML 2.0 Identity Provider (IdP) in production is the <b>Active Directory Federation Service </b>(AD FS) server.</div><div>Microsoft provides ADFS as a service for Windows Server which enable the web login using existing Active Directory credentials.</div><div><br></div><div><font size="6">Prerequisites</font></div><div><br></div><div>You need to use the following components in order to use ADFS to login into your OO Central instance:</div><div><ul><li><span style="background-color: transparent;">An Active Directory instance where all users have an <b>email address</b> attribute.</span></li><li>A OO Central Instance</li><li>A server running Microsoft Server 2016 with ADFS role enabled. This guide uses screnshots from Server 2016, but similar steps can be followed on other versions.</li><li>A SSL certificate to sign your ADFS login page and the fingerprint for that certificate.</li></ul></div><div><br></div><div>If you don't have the ADFS on one of your servers, follow the steps from this&nbsp;<a href="https://docs.microsoft.com/en-us/previous-versions/dynamicscrm-2016/deployment-administrators-guide/gg188612(v=crm.8)?redirectedfrom=MSDN" target="_blank">Microsoft KB</a>&nbsp;article in order to install and configure.</div><div><br></div><div><font size="6" style="">Step 1 - Trust the Identity Provider</font></div><div><br></div><div>First step is to import the public keys of the identity provider's certificates into the OO Central internal&nbsp;<b>key.store</b> file located at&nbsp;<span style="background-color: transparent;">&lt;path_to_central&gt;/central/var/security.</span></div><div><span style="background-color: transparent;"><br></span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span style="background-color: transparent;">1. Open ADFS Management, select the Certificates page from the Service dropdown and export the ADFS certificates:&nbsp;</span><span style="font-weight: 700; background-color: transparent;">Service communications</span><span style="background-color: transparent;">,&nbsp;</span><span style="font-weight: 700; background-color: transparent;">Token-decrypting</span><span style="background-color: transparent;">&nbsp;and&nbsp;</span><span style="font-weight: 700; background-color: transparent;">Token-signing certificate.</span></div><div><span style="font-weight: 700; background-color: transparent;"><br></span></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><img src="./mediawiki/images/PN/1.PNG"></blockquote><div><span style="background-color: transparent;"><br></span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span style="background-color: transparent;">2. Import them to the OO Central key.store using the following command:</span></div><div><span style="background-color: transparent;"><br></span></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><span style="font-weight: 700;"><i>&lt;path_to_java&gt;/bin/keytool -importcert -keystore key.store -alias &lt;your_custom_alias&gt; -file &lt;path_to_cer_file&gt;/&lt;certificate&gt;.cer</i></span></blockquote><div><b><br></b></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>3. Restart the OO Central instance.</div></div></blockquote><div><div><br></div><div><font size="6">Step 2 - Configure OO Central instance</font></div><div><br></div><div>After setting up ADFS and downloading the certificates, you need to configure your OO Central to authenticate using SAML.</div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>1. Access the OO Central from your browser, go to <b>System Configuration </b>and select the <b>SAML</b> from the <b>Security</b> page.</div></div><div><br></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>2. Enable the SAML option from the page, then add a new custom <b>Entity ID</b>&nbsp;if you want in the Service Provider area, or keep the predefined <b>"ooentityid"</b></div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>3. Add the <b>IDP metadata URL</b> of the ADFS server. It should look like this:&nbsp;</div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><b><i>https://&lt;fqdn-of-an-adfs-server&gt;/FederationMetadata/2007-06/FederationMetadata.xml</i></b></div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>4. Configure a new custom <b>User name</b> and <b>Group name attribute</b> or keep the predefined <b>"username"</b> and "<b>groups"</b> values.</div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><span style="background-color: transparent;"><i>Note: Those values will be mapped with the data comming from Active Directory</i></span></div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>5. If the user comming from ADFS is part of more then one group and those groups are separated within the SAML response, you need to define the <b>Group name delimiter</b> in order&nbsp;<span style="background-color: transparent;">to consider each on the groups individual.</span></div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>6. In case OO Central cannot directly access the ADFS, you need to configure a <b>Proxy host&nbsp;</b>and a <b>Port</b> to facilitate the communication between them.</div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>7. Unfortunately the SAML users cannot be used to execute scheduled OO flows, so you need to configure an <b>Internal user </b>from your OO for scheduling tasks.</div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>8. Save the configurations using the <b>Save </b>buttom from the buttom.</div></div></blockquote><div><div><br></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><img src="./mediawiki/images/PN/2.PNG"></div></div></blockquote><div><div><br></div><div>Download the OO Central metadata which needs to be added in the ADFS when the OO Central is configured as a new Relying Party Trust, using the Download metadata button</div><div><br></div><div>Note: Before accessing the OO Central using the ADFS users, make sure you have an internal admin user, for this.&nbsp;</div><div>If you get locked out, with no access via the identity provider, you can log into OO directly. To log in directly, go to http(s)/&lt;host&gt;:&lt;port&gt;/oo/login/direct.</div><div><br></div><div>Step 3 - Adding the OO Central as a new Relying Party Trust</div><div><br></div><div>At this point you should be ready to set up the ADFS connection with your OO Central instance. The connection between ADFS and OO Central is defined using a Relying Party Trust.</div><div><br></div><div>From AD FS Management page, select the Relying Party Trust, and add a new Standard Relying Party Trust from the Actions sidebar. This starts the configuration wizard for a new trust.</div><div><br></div><div>3.jpg</div><div><br></div><div>1. Select "Claims aware" and start the relying party trust configuration.</div><div>2. In the Select Data Source screen, select the second option, Import data about the relying party from a file, and browser for the OO Central metadata you downloaded in the previous steps.</div><div><br></div><div>4.jpg</div><div><br></div><div>3. On the Specify Display Name page, enter a Display name. This should be the same as the Entity ID you defined in the OO Central SAML configuration page. The default value in OO is "ooentityid"</div><div><br></div><div>5.jpg</div><div><br></div><div>4. On the next screen, chose the access control policy you want. We suggest to select the "Permit everyone".</div><div><br></div><div>6.jpg</div><div><br></div><div>5. On the Ready to Add Trust screen, review the configurations, and click next to add the relying party trust to the AD FS configuration database.</div><div><br></div><div>7.jpg</div><div><br></div><div>6. On the Finish screen, check the "Configure claims issuance policy for this application option"&nbsp; option to be able to configure the claim rules.</div><div>You can do this also by selecting the "ooentityid" relying party trust then clieck on the "Edit Access Control Policy"</div><div><br></div><div>8.jpg&nbsp;</div><div><br></div><div>Step 4 - Creating claim rules</div><div><br></div><div>Once the relying party trust has been created, you can create the claim rules that will facilitate the correct communication between ADFS and OO Central</div><div><br></div><div>10.jpg</div><div><br></div><div>1. Click on Add Rule to create a new rule. First rule should be created from the "Send LDAP Attributes as Claims" template rule.</div><div><br></div><div>11.jpg</div><div><br></div><div>2. On the next screen, using Active Directory as your attribute store, do the following:</div><div><br></div><div>a. From the LDAP Attribute column, select E-Mail Addresses.</div><div>b. On the assigned Outgoing Claim Type, manually type the "username". This value should be same with the value of the User name attribute from OO Central configuration page.</div><div>c. From the LDAP Attribute column, select Token-Groups - Unqualified Names</div><div>d. On the assigned Outgoing Claim Type, manually type the "groups". This value should be same with the value of the Group name attribute from OO Central configuration page.</div><div>Click on OK to save the new rule.</div><div><br></div><div>12.jpg</div><div><br></div><div>3. Create another new rule by clicking Add Rule, this time selecting Transform an Incoming Claim as the template.</div><div><br></div><div>13.jpg</div><div><br></div><div>4. On the next screen:</div><div><br></div><div>a. Type the "username" as the Incoming Claim Type.</div><div>b. For Outgoing Claim Type, select Name ID.</div><div>c. For Outgoing Name ID Format, select Email.</div><div><br></div><div>14.jpg</div><div><br></div><div>5. Finally, click OK to create the claim rule, and then OK again to finish creating rules.</div><div><br></div><div>Step 5 - Adjusting the trust settings</div><div><br></div><div>The relying party trust settings can be adjust for proper communication between the IdP and the OO Central.</div><div>To access these settings, select Properties from the Actions sidebar while you have the RPT selected.</div><div><br></div><div>1. In the Advanced tab, make sure SHA-1 is specified as the secure hash algorithm. This is the default value that OO Central is using.</div><div><br></div><div>15.jpg</div><div><br></div><div>You can change the signing algorithm by adding the following new propertie at the end of the "wrapper.java.additional" list of parameters.&nbsp;</div><div><span style="white-space:pre">	</span>Make sure to use numbers that are unique. If the last number is 34 then you can use numbers starting with 35 like below.</div><div><span style="white-space:pre">	</span>The value should be sha1, sha256 or sha512.</div><div><span style="white-space:pre">		</span></div><div><span style="white-space:pre">	</span>e.g</div><div><span style="white-space:pre">	</span>#Extra settings to add Central</div><div><span style="white-space:pre">	</span>wrapper.java.additional.35=-Dsaml.rsa.algorithm=sha256</div><div><br></div><div>Then restart the OO Central</div><div><br></div><div><br></div><div><br></div><div>Troubleshoting</div><div><br></div><div>If the configurations are not done correctly, the communication between OO and ADFS through SAML can suffer.</div><div>In case of any problem, we suggest to set the SAML logs from OO to DEBUG, to be able to see exactly what is the cause of the issue, then restart the OO Central.</div><div>In order to do this, edit the log4j.properties file which is located under the /central/conf path, and set to DEBUG the SAML paramers, like below:</div><div><br></div><div>#SAML</div><div>log4j.logger.org.springframework.security.saml=DEBUG</div><div>log4j.logger.org.opensaml=DEBUG</div><div><br></div><div>Possible errors that can occur in general.log file:</div><div><br></div><div>1.</div><div><br></div><div>Error:</div><div>Solution:</div><div><br></div><div>2.</div><div><br></div><div>Error:</div><div>Solution:</div></div>