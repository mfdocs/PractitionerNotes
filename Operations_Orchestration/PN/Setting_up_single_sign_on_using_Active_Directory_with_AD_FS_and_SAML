<div>Setting up single sign-on using Active Directory with ADFS and SAML.</div><div><br></div><div>Micro Focus Operations Orchestration supports sign-on (SSO) logins through SAML 2.0.</div><div>The most used SAML 2.0 Identity Provider (IdP) in production is the Active Directory Federation Service (ADFS) server.</div><div>ADFS is a service provided by Microsoft as a standard role for Windows Server that provides a web login using existing Active Directory credentials.</div><div><br></div><div>Prerequisites</div><div><br></div><div>To use ADFS to log in to your OO Central instance, you need the following components:</div><div><br></div><div>An Active Directory instance where all users have an email address attribute.</div><div>A OO Central Instance</div><div>A server running Microsoft Server 2016 with ADFS role enabled. This guide uses screnshots from Server 2016, but similar steps can be followed on other versions.</div><div>A SSL certificate to sign your ADFS login page and the fingerprint for that certificate.</div><div><br></div><div>If you don't have the ADFS on one of your servers, follow the steps from this Microsoft KB article in order to install and configure.</div><div><br></div><div>When you have a fully installed ADFS installation, note down the value for the 'SAML 2.0/W-Federation' URL in the ADFS Endpoints section.&nbsp;</div><div>If you chose the defaults for the installation, this will be '/adfs/ls/'.</div><div><br></div><div>Step 1 - Trust the Identity Provider</div><div><br></div><div>First step is to import the public keys of the identity provider's certificates into the OO Central key.store</div><div><br></div><div>Open ADFS Management, select the Certificates page from the Service dropdown and export the AD FS certificates: Service communications, Token-decrypting and Token-signing certificate</div><div><br></div><div>1.jpg</div><div><br></div><div>Import them to the OO Central key.store using the following command:</div><div><br></div><div>&lt;PATH_TO_JAVA&gt;/bin/keytool -importcert -keystore key.store -alias &lt;your_custom_alias&gt; -file &lt;path_to_cer_file&gt;/&lt;certificate&gt;.cer</div><div><br></div><div>Restart the OO Central instance.</div><div><br></div><div>Step 2 - Configure OO Central</div><div><br></div><div>After setting up ADFS, you need to configure your OO Central to authenticate using SAML</div><div><br></div><div>Access the OO Central, go to System Configuration and select the SAML from the Security page.</div><div>First of all, enable the SAML option from the page, then add a new custom Entity ID you want in the Service Provider area, or keep the predefined "ooentityid"</div><div><br></div><div>Add the IDP metadata URL of the ADFS server. It will look like this:&nbsp;</div><div><br></div><div>https://&lt;fqdn-of-an-adfs-server&gt;/FederationMetadata/2007-06/FederationMetadata.xml</div><div><br></div><div>Configure a new custom User name and Group name attribute or keep the predefined "username" and "groups" values.</div><div>Those values will be mapped with the data comming from Active Directory</div><div>If the user comming from ADFS is part of more then one group and those groups are separated within the SAML response, you need to define the Group name delimiter in order&nbsp;</div><div>to consider each on the groups individual.</div><div><br></div><div>In case OO Central cannot directly access the ADFS, you need to configure a Proxy and a Port to facilitate the communication between them.</div><div><br></div><div>Unfortunately the SAML users cannot be used to execute scheduled OO flows, so you need to configure an internal user from your OO for scheduling tasks.</div><div><br></div><div>Save the configurations using the Save buttom from the buttom.</div><div><br></div><div>2.jpg</div><div><br></div><div>Download the OO Central metadata which needs to be added in the ADFS when the OO Central is configured as a new Relying Party Trust, using the Download metadata button</div><div><br></div><div>Note: Before accessing the OO Central using the ADFS users, make sure you have an internal admin user, for this.&nbsp;</div><div>If you get locked out, with no access via the identity provider, you can log into OO directly. To log in directly, go to http(s)/&lt;host&gt;:&lt;port&gt;/oo/login/direct.</div><div><br></div><div>Step 3 - Adding the OO Central as a new Relying Party Trust</div><div><br></div><div>At this point you should be ready to set up the ADFS connection with your OO Central instance. The connection between ADFS and OO Central is defined using a Relying Party Trust.</div><div><br></div><div>From AD FS Management page, select the Relying Party Trust, and add a new Standard Relying Party Trust from the Actions sidebar. This starts the configuration wizard for a new trust.</div><div><br></div><div>3.jpg</div><div><br></div><div>1. Select "Claims aware" and start the relying party trust configuration.</div><div>2. In the Select Data Source screen, select the second option, Import data about the relying party from a file, and browser for the OO Central metadata you downloaded in the previous steps.</div><div><br></div><div>4.jpg</div><div><br></div><div>3. On the Specify Display Name page, enter a Display name. This should be the same as the Entity ID you defined in the OO Central SAML configuration page. The default value in OO is "ooentityid"</div><div><br></div><div>5.jpg</div><div><br></div><div>4. On the next screen, chose the access control policy you want. We suggest to select the "Permit everyone".</div><div><br></div><div>6.jpg</div><div><br></div><div>5. On the Ready to Add Trust screen, review the configurations, and click next to add the relying party trust to the AD FS configuration database.</div><div><br></div><div>7.jpg</div><div><br></div><div>6. On the Finish screen, check the "Configure claims issuance policy for this application option"&nbsp; option to be able to configure the claim rules.</div><div>You can do this also by selecting the "ooentityid" relying party trust then clieck on the "Edit Access Control Policy"</div><div><br></div><div>8.jpg&nbsp;</div><div><br></div><div>Step 4 - Creating claim rules</div><div><br></div><div>Once the relying party trust has been created, you can create the claim rules that will facilitate the correct communication between ADFS and OO Central</div><div><br></div><div>10.jpg</div><div><br></div><div>1. Click on Add Rule to create a new rule. First rule should be created from the "Send LDAP Attributes as Claims" template rule.</div><div><br></div><div>11.jpg</div><div><br></div><div>2. On the next screen, using Active Directory as your attribute store, do the following:</div><div><br></div><div>a. From the LDAP Attribute column, select E-Mail Addresses.</div><div>b. On the assigned Outgoing Claim Type, manually type the "username". This value should be same with the value of the User name attribute from OO Central configuration page.</div><div>c. From the LDAP Attribute column, select Token-Groups - Unqualified Names</div><div>d. On the assigned Outgoing Claim Type, manually type the "groups". This value should be same with the value of the Group name attribute from OO Central configuration page.</div><div>Click on OK to save the new rule.</div><div><br></div><div>12.jpg</div><div><br></div><div>3. Create another new rule by clicking Add Rule, this time selecting Transform an Incoming Claim as the template.</div><div><br></div><div>13.jpg</div><div><br></div><div>4. On the next screen:</div><div><br></div><div>a. Type the "username" as the Incoming Claim Type.</div><div>b. For Outgoing Claim Type, select Name ID.</div><div>c. For Outgoing Name ID Format, select Email.</div><div><br></div><div>14.jpg</div><div><br></div><div>5. Finally, click OK to create the claim rule, and then OK again to finish creating rules.</div><div><br></div><div>Step 5 - Adjusting the trust settings</div><div><br></div><div>The relying party trust settings can be adjust for proper communication between the IdP and the OO Central.</div><div>To access these settings, select Properties from the Actions sidebar while you have the RPT selected.</div><div><br></div><div>1. In the Advanced tab, make sure SHA-1 is specified as the secure hash algorithm. This is the default value that OO Central is using.</div><div><br></div><div>15.jpg</div><div><br></div><div>You can change the signing algorithm by adding the following new propertie at the end of the "wrapper.java.additional" list of parameters.&nbsp;</div><div><span style="white-space:pre">	</span>Make sure to use numbers that are unique. If the last number is 34 then you can use numbers starting with 35 like below.</div><div><span style="white-space:pre">	</span>The value should be sha1, sha256 or sha512.</div><div><span style="white-space:pre">		</span></div><div><span style="white-space:pre">	</span>e.g</div><div><span style="white-space:pre">	</span>#Extra settings to add Central</div><div><span style="white-space:pre">	</span>wrapper.java.additional.35=-Dsaml.rsa.algorithm=sha256</div><div><br></div><div>Then restart the OO Central</div><div><br></div><div><br></div><div><br></div>