<html><h2 style="margin-top: 16px;"><span style="font-size:16pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082556">Introduction</a></span></span></span></span></span></h2>
<span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">As most of us know any customer who is willing to upgrade to the latest version of OpsBridge Suite, has go through multiple (quarterly) upgrades, since there is no direct upgrade supported so far.&nbsp;This particular document tries to capture each and every, detailed aspect which needs to be kept in mind and worked upon to achieve a successful upgrade, without (or minimal) Configuration DATA loss (from the Postgres side of the house).</span></span></span><br>
&nbsp;
<h2 style="margin-top: 16px;"><span style="font-size:16pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082558">Back up and shutdown of Cluster</a></span></span></span></span></span></h2>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082559">Get the number of Replica Sets</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">Store the output of the below command to keep a track of the replicasets being configured in your current working (old environment)</span></span></span><br>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl get replicasets --all-namespaces &gt;&gt; /tmp/&lt;ReplicaSets.txt&gt;</span></span></span></span>

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082560">Store the XPL configurations from current environment</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">One needs to take a backup of the below files from the NFS location, in order to save the XPL settings being made. The changes need to be manually set on the new environment.</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>Collection Service (Collect once data broker pod)</b></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-conf-volume&gt;/co/oa/oa1/conf/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>For OBM in container</b></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-0&gt;/omi/var/opt/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-0&gt;/omi/var/opt/OV/shared/server/conf/xpl/config/local_settings.ini</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-1&gt;/omi/var/opt/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-1&gt;/omi/var/opt/OV/shared/server/conf/xpl/config/local_settings.ini</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: There is no use case of backing up the entire Data directory, as with new version of Suite, customer would be deploying new policies. (May be monitoring policies or say the policies for virtualization collector).</span></span><br>
&nbsp;
<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082561">DNS Configmap for non-DNS environment</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">In case if the environment was a non-DNS environment, kindly take a backup of the entries in the configuration map named dns-hosts-configmap, under kube-system namespace, to be used in the new 2019.11 environment too.</span></span><br>
<span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif"><span style="color:#c00000">kubectl edit cm dns-hosts-configmap -n kube-system</span></span></span></span><br>
&nbsp;
<h2 style="margin-top:3px"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082562">Backup custom node list and ucmdb config.json</a></span></span></span></span></span></h2>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b><u>:</u> Skip if you have not configured it as part of Agent Metric Collector in your older version of OpsBridge Suite</span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">This is needed only if the current version of OpsBridge Suite installed, has Collection Service capability selected and Agent Metric Collector configured. <b>In case if you have NOT configured or customized the node list, then feel free to skip this section</b>. One needs to back up the below files from NFS location.</span></span><br>
&nbsp;
<h3 style="margin-top:3px"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082563">OBM containerized</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File name: </b>Custom Node list file</span></span>

<p><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>Location:</b> <span style="color:#c00000">&lt;NFS-conf-volume&gt;/content-administration/var/content-administration/content/custom/</span></span></span></p>

<h3 style="margin-top:3px"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082564">External OBM</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Login to the itom-opsb-content-administration POD, and back up the below mentioned file. Use the ‘kubectl cp’ command mentioned below to take a back-up of the same file.</span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File name: </b>sample_ucmdb_config.json</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>Location</b>: <span style="color:#c00000">/opt/content-administration/conf</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl -n &lt;opsbridge_namespace&gt; exec -ti &lt;itom-opsb-content-administration-pod&gt; -c itom-opsb-content-administration bash</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl cp &lt;opsbridge_namespace&gt;/&lt;itom-opsb-content-administration-pod&gt;:/opt/content-administration/conf/&lt;sample_ucmdb_config.json&gt; /tmp/sample_ucmdb_config.json -c itom-opsb-content-administration</span></span></span><br>
&nbsp;
<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082565">Store the YAML Changes</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run the script (will be shared to the customers) to capture the values changed/edited in an html format. Internally it would use the ‘kubectl diff’ command. As these values/changes needs to be done in the YAML files, post installation of 2019.11 version too.</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: The kubectl <b>diff</b> option may not be available in older version of K8S.</span></span><br>
&nbsp;</html>