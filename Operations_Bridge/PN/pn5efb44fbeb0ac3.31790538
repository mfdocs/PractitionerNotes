<html><h2 style="margin-top: 16px;"><strong><span style="font-size:16pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082556">Introduction</a></span></span></span></span></span></strong></h2>

<h2><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">Introduction</span></span></span></h2>
<span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">As most of us know any customer who is willing to upgrade to the latest version of OpsBridge Suite, has go through multiple (quarterly) upgrades, since there is no direct upgrade supported so far.&nbsp;This particular document tries to capture each and every, detailed aspect which needs to be kept in mind and worked upon to achieve a successful upgrade, without (or minimal) Configuration DATA loss (from the Postgres side of the house).</span></span></span>&nbsp;

<h2 style="margin-top: 16px;"><strong><span style="font-size:16pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082558">Back up configuration</a></span></span></span></span></span></strong></h2>
&lt;&nbsp;<span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">and </span></span></span>TBD&gt;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082559">Get the number of Replica Sets</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">Store the output of the below command to keep a track of the replicasets being configured in your current working (old environment)</span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl get replicasets --all-namespaces &gt;&gt; /tmp/&lt;ReplicaSets.txt&gt;</span></span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082560">Store the XPL configurations from current environment</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">One needs to take a backup of the below files from the NFS location, in order to save the XPL settings being made. The changes need to be manually set on the new environment.</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>Collection Service (Collect once data broker pod)</b></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-conf-volume&gt;/co/oa/oa1/conf/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>For OBM in container</b></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-0&gt;/omi/var/opt/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-0&gt;/omi/var/opt/OV/shared/server/conf/xpl/config/local_settings.ini</span></span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-1&gt;/omi/var/opt/OV/conf/xpl/config/local_settings.ini</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">&lt;NFS-omi-volume-1&gt;/omi/var/opt/OV/shared/server/conf/xpl/config/local_settings.ini</span></span></span></div>
&nbsp;

<div class="Admonition_Note"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: There is no use case of backing up the entire Data directory, as with new version of Suite, customer would be deploying new policies. (May be monitoring policies or say the policies for virtualization collector).</span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082561">DNS Configmap for non-DNS environment</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">In case if the environment was a non-DNS environment, kindly take a backup of the entries in the configuration map named dns-hosts-configmap, under kube-system namespace, to be used in the new 2019.11 environment too.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif"><span style="color:#c00000">kubectl edit cm dns-hosts-configmap -n kube-system</span></span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082562">Backup custom node list and ucmdb config.json</a></span></span></span></span></span></h3>

<div class="Admonition_Note"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b><u>:</u> Skip if you have not configured it as part of Agent Metric Collector in your older version of OpsBridge Suite</span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">This is needed only if the current version of OpsBridge Suite installed, has Collection Service capability selected and Agent Metric Collector configured. <b>In case if you have NOT configured or customized the node list, then feel free to skip this section</b>. One needs to back up the below files from NFS location.</span></span><br>
&nbsp;
<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082563">OBM containerized</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File name: </b>Custom Node list file</span></span><br>
<b style="font-family: Calibri, sans-serif; font-size: 11pt;">Location:</b><span style="font-family: Calibri, sans-serif; font-size: 11pt;"> </span><span style="font-family: Calibri, sans-serif; font-size: 11pt; color: rgb(192, 0, 0);">&lt;NFS-conf-volume&gt;/content-administration/var/content-administration/content/custom/</span>

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082564">External OBM</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Login to the itom-opsb-content-administration POD, and back up the below mentioned file. Use the ‘kubectl cp’ command mentioned below to take a back-up of the same file.</span></span><br>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File name: </b>sample_ucmdb_config.json</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>Location</b>: <span style="color:#c00000">/opt/content-administration/conf</span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl -n &lt;opsbridge_namespace&gt; exec -ti &lt;itom-opsb-content-administration-pod&gt; -c itom-opsb-content-administration bash</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl cp &lt;opsbridge_namespace&gt;/&lt;itom-opsb-content-administration-pod&gt;:/opt/content-administration/conf/&lt;sample_ucmdb_config.json&gt; /tmp/sample_ucmdb_config.json -c itom-opsb-content-administration</span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082565">Store the YAML Changes</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run the script (will be shared to the customers) to capture the values changed/edited in an html format. Internally it would use the ‘kubectl diff’ command. As these values/changes needs to be done in the YAML files, post installation of 2019.11 version too.</span></span>

<div class="Admonition_Note"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: The kubectl <b>diff</b> option may not be available in older version of K8S.</span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082566">Store the MASTER_KEY from ucmdb POD</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Login to the ucmdb POD and get the secret by executing the below command</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">get_secret MASTER_KEY</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">This VALUE should be saved. And to be used in the new environment.</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">One can also get the secret from the below command</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl -n core exec -i $(kubectl -n core get pods -o name -l app=suite-conf-sel-opsbridge | cut -d '/' -f 2) -c suite-config -- get_secret MASTER_KEY</span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082567">Back up the Certificates realms and PEM files</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Back up the RE: Realm External, the Cert loaded on NGINX controllers.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl cp core/&lt;suite-conf-pod-opsbridge&gt;:/var/run/secrets/boostport.com/trustedCAs/RE_ca.crt /tmp/RE_ca.crt -c kubernetes-vault-renew</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">Basically, one needs to retrieve the cert and key from the secret of the OpsBridge namespace (as this is the cert which is used to terminate port 443). Run the below command to retrieve the same. The name of the secret would be nginx-default-secret under OpsBridge Namespace for later version of Suites.</span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><code><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl get secret ingress-controller-tls-secret -n &lt;opsbridge_namespace&gt; -o json | jq '.data."tls.crt"' --raw-output | base64 -d &gt; chain.pem</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">kubectl get secret ingress-controller-tls-secret -n &lt;opsbridge_namespace&gt; -o json | jq '.data."tls.key"' --raw-output | base64 -d &gt; key.pem</span></span></span></code></div>
&nbsp;

<div class="Admonition_Note"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: In case if you see that ‘jq’ is not installed on the CentOS, Master node. Run the below commands (after consulting your system admin).</span></span><br>
<span style="font-size:11pt"><span style="line-height:normal"><span style="tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span style="vertical-align:baseline"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">yum install epel-release -y</span></span></span></span></span></span><br>
<span style="font-size:11pt"><span style="line-height:normal"><span style="tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span style="vertical-align:baseline"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">yum install jq -y</span></span></span></span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082568">Configure Event Auto Archiving</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Follow the instructions in the below document for Event Archiving.</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span class="MsoHyperlink" style="color:#0563c1"><span style="text-decoration:underline"><a href="https://docs.microfocus.com/itom/Operations_Bridge:2019.11/oprArchiveEventsCLI" style="color:#0563c1; text-decoration:underline" target="_blank">https://docs.microfocus.com/itom/Operations_Bridge:2019.11/oprArchiveEventsCLI</a></span></span></span></span><br>
&nbsp;
<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082569">Clear the UCMDB history</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Follow the instructions in the below document to clear/purge the UCMDB history</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span class="MsoHyperlink" style="color:#0563c1"><span style="text-decoration:underline"><a href="https://docs.microfocus.com/itom/Operations_Bridge_Manager:2019.11/ServerAdminPurgingTr" style="color:#0563c1; text-decoration:underline" target="_blank">https://docs.microfocus.com/itom/Operations_Bridge_Manager:2019.11/ServerAdminPurgingTr</a></span></span></span></span><br>
&nbsp;
<h2 style="margin-top:3px"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082570">Bring down the cluster</a></span></span></span></span></span></h2>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Make sure all the PODS are up and running.&nbsp;Shut down Suite pods by Running the below command.&nbsp;Make sure that all the PODS are DOWN and the Suite too. Ignore the Completed pods.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">${K8S_HOME}/scripts/cdfctl.sh -f runlevel set -l DOWN</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run the below command on all the Worker Nodes. Once it completes on the Worker Nodes, execute the same on the Master Nodes.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">${K8S_HOME}/bin/kube-stop.sh -y</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Check if there any mount points still active. On the Master node, run the following command. If you see any residual, then kindly run the second command to un-mount the same. To be executed, in case if the NFS is on the Master node.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">df -k | grep kubernetes</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">for f in $(df | awk '/kubernetes/ {print $6}'); do umount $f; done</span></span></span></div>
&nbsp;

<div class="Admonition_Note"><b><u><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">Note</span></span></span></u></b><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">: Set ${K8S_HOME} to /opt/kubernetes if not resolved.</span></span><br>
<span style="font-family:Calibri,sans-serif">Shut down the VM’s and take a snapshot of the same Virtual Machines, which are part of the cluster set up.</span></span>&nbsp;</div>

<h2 style="margin-top: 16px;"><span style="font-size:16pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082573">Postgres DB migration</a></span></span></span></span></span></h2>

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082574">Pre-requisite</a></span></span></span></span></span></h3>

<ol>
	<li class="MsoNoSpacing" style="margin-left: 8px; text-align: justify;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Make sure that the CDF cluster is DOWN.</span></span></li>
	<li class="MsoNoSpacing" style="margin-left: 8px; text-align: justify;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Enough space for taking the Postgres dump</span></span></li>
</ol>

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082575">Check postgres connection with super user</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">From the Postgres Node, run the below command</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">psql "dbname=&lt;dbname&gt; password=&lt;password&gt; host=&lt;pg_host&gt; port=&lt;pg_port&gt; user=&lt;super_user&gt;"</span></span></span><br>
<strong><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">OR</span></span></strong><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">su - postgres</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">psql postgres postgres</span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082576">Get the current Postgres Version</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Once logged in as super user, run the below command. This would be good to have a check on the version and its compatibility for upgrade to higher version of Postgres.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">SHOW server_version ;</span></span></span></div>
&nbsp;

<h3 style="margin-top:3px"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082577">Get the DB list from the External POSTGRES Node</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">As a super user, run the below command to get the OpsBridge Suite DB list. As of today, the below listed Databases would be targeted for migration.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">SELECT datname FROM pg_database WHERE datistemplate = false and datname != 'replication_db' and datname != 'postgres' ;</span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082578">Check if suite username passed is correct</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">As a super user, run the below command to check if the owner has the access to the OpsBridge Suite DB list. This would be necessary in case it’s automated in the script and also make sure that we know the credentials in the Source and Target environment are same.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">Select count(name) from (SELECT d.datname as name,pg_catalog.pg_get_userbyid(d.datdba) as owner FROM pg_catalog.pg_database d )a where name='&lt;suite_db_name&gt;' and owner != 'postgres' and owner = '&lt;suite_db_user&gt;' ;</span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082579">Get the Total database size</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">As a super user, run the below command to get the size of the DB</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">SELECT sum(pg_database_size(pg_database.datname)/1024.0) FROM pg_database ;</span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082580">Dump&nbsp;the OpsBridge databases</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Make sure the Postgres DB is UP and RUNNING.&nbsp;</span></span><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run the below command to get the postgres service name:</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">systemctl status | grep postgresql | grep service</span></span></span></div>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">And then check the status of the service using the command. It should show active (running):</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">systemctl status &lt;postgresql-service-name&gt;</span></span></span></div>
<br>
<span style="font-size:11.0pt"><span style="font-family:Calibri,sans-serif"><u><strong>For large Database</strong>:</u></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run VACCUMLO on &lt;event&gt; DB and &lt;RTSM&gt; DB (not on other DBs). Run the below command to analyze.</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">/usr/pgsql-&lt;version&gt;/bin/vacuumlo -v -n -h &lt;pg_host&gt; -U &lt;super_user&gt; -W -p &lt;pg_port&gt; &lt;suite_db_name&gt;</span></span></span>

<div class="Admonition_Note"><span style="font-size:11.0pt"><span style="font-family:Calibri,sans-serif"><b><u>Note</u></b>: -n is for don’t remove anything, just show what would be done</span></span></div>
<br>
<span style="font-size:11.0pt"><span style="font-family:Calibri,sans-serif">Once confirmed, execute without ‘-n’ option.</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">vacuumlo -v -h &lt;pg_host&gt; -U &lt;super_user&gt; -W -p &lt;pg_port&gt; &lt;suite_db_name&gt;</span></span></span></div>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">On completion, one should see the below message</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">Successfully removed #N large objects from database "&lt;suite_db_name&gt;".</span></span></span></div>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Run the below command to create the dump file for all the databases:</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;autopassdb&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;autopassdb&gt;.sql</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;cdfidmdb&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;cdfidmdb&gt;.sql</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;bvd&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;bvddb&gt;.sql</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;event&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;eventdb&gt;.sql</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;mgmt&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;mgmtdb&gt;.sql</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">pg_dump -Fp -c -v -h &lt;pg_host&gt; -d &lt;rtsm&gt; -p &lt;pg_port&gt; -U &lt;super-user&gt; -f &lt;PG_DUMP_DIR&gt;/&lt;rtsmdb&gt;.sql</span></span></span></span></div>
&nbsp;

<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082581">Upgrade the Postgres version</a></span></span></span></span></span></h3>

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082582">Back up the existing pg_hba.conf and postgresql.conf</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Take a back up of the below .conf files from the Postgres server.<br>
/var/lib/pgsql/9.5/data/pg_hba.conf</span></span><br>
<span style="font-size:11pt"><span style="line-height:107%"><span style="font-family:Calibri,sans-serif">/var/lib/pgsql/9.5/data/postgresql.conf</span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><b><u><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">Note</span></span></span></u></b><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">: The path might change based on the version installed.</span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082583">Shutdown the DB</a></span></span></span></span></span></h4>
<span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">Login as Postgres super user and run the below command.</span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">su - &lt;postgres_su_user&gt;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">/usr/pgsql-9.5/bin/pg_ctl stop</span></span></span></div>
&nbsp;

<div class="Admonition_Note"><b><u><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">Note</span></span></span></u></b><span style="font-size:11.0pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri&quot;,sans-serif">: The path for pg_ctl might change based on the version installed.</span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082584">Rename the old Installation directory</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">mv /usr/pgsql-9.5 /usr/pgsql-9.5_old</span></span></span><br>
&nbsp;
<h4>&nbsp;<a name="_Toc42082585" style="font-family: &quot;Calibri Light&quot;, sans-serif; font-size: 12pt; background-color: rgb(255, 255, 255);">Install the new version</a></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Select the suitable options from the below page. Below list of commands is for installing the version Postgres 10.</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span class="MsoHyperlink" style="color:#0563c1"><span style="text-decoration:underline"><a href="https://www.postgresql.org/download/linux/redhat/" style="color:#0563c1; text-decoration:underline" target="_blank">https://www.postgresql.org/download/linux/redhat/</a></span></span></span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">yum install <a href="https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm" style="color:#0563c1; text-decoration:underline"><span style="color:#c00000"><span style="text-decoration:none"><span style="text-underline:none">https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span></span></span></a></span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">yum install postgresql10</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">yum install postgresql10-server</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">yum install postgresql10-contrib</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">/usr/pgsql-10/bin/postgresql-10-setup initdb</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">systemctl enable postgresql-10</span></span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="font-size:9.0pt"><span style="color:#c00000">systemctl start postgresql-10</span></span></span></span></div>
&nbsp;

<h4 style="margin-top: 3px;"><span style="font-size:12pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#1f4d78"><span style="font-weight:normal"><a name="_Toc42082586">Restore the changes in the conf files</a></span></span></span></span></span></h4>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File</b> <span style="color:#c00000">/var/lib/pgsql/10/data/pg_hba.conf</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Add the below entries at the end of the file</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">host all all 0.0.0.0/0 md5</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">host all all ::/0 md5</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><b>File</b> <span style="color:#c00000">/var/lib/pgsql/10/data/postgresql.conf</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Uncomment and change the entries of listen_addresses and port to below</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">listen_addresses = '*'</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">port = &lt;pg_port&gt;</span></span></span></div>
<br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Followed by the restart of the service</span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">systemctl restart postgresql-10.service</span></span></span><br>
&nbsp;
<h3 style="margin-top: 3px;"><span style="font-size:13pt"><span style="line-height:107%"><span style="font-family:&quot;Calibri Light&quot;,sans-serif"><span style="color:#2e74b5"><span style="font-weight:normal"><a name="_Toc42082587">Restore the DUMP</a></span></span></span></span></span></h3>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif">Recreate the Databases and users which existed in Old OpsBridge Postgres DB</span></span>

<div style="background:#eeeeee;border:1px solid #cccccc;padding:5px 10px;"><span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE ROLE &lt;cdfidmuser&gt; WITH LOGIN PASSWORD '&lt;Password&gt;'; </span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;cdfidmdb&gt; OWNER &lt;cdfidmuser&gt;; </span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;autopassdb&gt; OWNER &lt;cdfidmuser&gt;;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;bvddb&gt; OWNER &lt;cdfidmuser&gt;;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;rtsmdb&gt; OWNER &lt;cdfidmuser&gt;; </span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">\c &lt;rtsmdb&gt; ;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE EXTENSION IF NOT EXISTS "uuid-ossp";</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;mgmtdb&gt; OWNER &lt;cdfidmuser&gt;; </span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">\c &lt;mgmtdb&gt; ;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE EXTENSION IF NOT EXISTS "uuid-ossp";</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE DATABASE &lt;eventdb&gt; OWNER &lt;cdfidmuser&gt;;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">\c &lt;eventdb&gt; ;</span></span></span><br>
<span style="font-size:11pt"><span style="font-family:Calibri,sans-serif"><span style="color:#c00000">CREATE EXTENSION IF NOT EXISTS "uuid-ossp"</span></span></span></div>
</html>