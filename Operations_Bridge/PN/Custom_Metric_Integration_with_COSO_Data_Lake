<h1>Custom metric integration to the COSO Data Lake for OpsBridge reporting solutions</h1><p>This section describes how to extend the COSO Data Lake to collect custom metrics to enable custom reporting using Business Value Dashboard or your own BI reporting tools.<br></p><p>This section covers the following topics:</p><p></p><ul><li>Custom metric collection concepts</li><li>Metric life cycle</li><li>Steps to create your custom content</li><li>Fully functional end to end example</li></ul><p></p><h2>Custom metric collection concepts</h2><p>There are two approaches to ingesting Operations Agent custom metrics into the COSO Data Lake:<br></p><h3>Collection Services</h3><p>The Collection Service is a containerized micro service designed to centrally collect large amounts of data from the remote Operations Agents’ Performance Collection Component and store it in the COSO Data Lake. It supports collecting data from all Operations Agent supported platforms, and all supported versions. The Collection Service is horizontally scalable. It spawns one or more Agent Metric Collector containers, depending on the number of collections you configure, which in turn define the nodes from which to collect data.</p><p>This is the recommended approach where the data is used for reporting purposes and doesn’t require real time analytics or central thresholding.</p><p>You use the Content Administration Service, a containerized micro service, to configure the Collection Service to collect data from the Operations Agents on a scheduled basis.&nbsp; The data collection mechanism uses the CODA client APIs to connect to the Operations Agent, which uses HTTPS-based communications by default, and falls back to HTTP,&nbsp; if HTTPS is unavailable.&nbsp; Note that the Collection Service requires a certificate from OBM, before the agent metric collection can start.&nbsp; The Content Administration Service also configures the COSO Data Lake to store and manage the data.</p><h3>OBM policies</h3><p>OBM policies are used to collect data from any of these sources:</p><p></p><ul><li>XML File</li><li>Structured Log File</li><li>REST web service</li><li>Performance Collection Component</li></ul><p></p><p>In this case the data is typically used for real time graphing and central thresholding purposes, but it can also be used for reporting since it is stored in the COSO Data Lake. You deploy OBM policies to the Operations Agents that configure what data to send to the COSO Data Lake via an HTTPS POST and how frequently.</p><p>Metric Streaming Configuration policies are supported on all Operations Agent platforms.&nbsp; All other metric collection policy types are supported on Windows and Linux platforms only.</p><p>You use the Content Administration Service to configure the COSO Data Lake to store and manage the data.</p><p>The following diagram shows the components used in collecting custom metrics.</p><div><br></div><p class="MsoNormal"><span lang="EN-AU"><font color="#ff0000">&lt;&lt;&lt;&lt; DIAGRAM TO BE INSERTED &gt;&gt;&gt;&gt;</font></span></p><p class="MsoNormal"><span lang="EN-AU"><font color="#ff0000">&lt;&lt;&lt;&lt; Table to be inserted &gt;&gt;&gt;&gt;</font></span></p><h2>Metric life cycle</h2><p class="MsoNormal">You need to consider what metrics to collect, whether aggregation is required and how long to retain the data in the COSO Data Lake.</p><h3>Define</h3><p class="MsoNormal">This involves defining how the COSO Data Lake is configured to process custom metrics:<br></p><p class="MsoNormal"></p><ul><li>Database table(s) in Vertica</li><li>Kafka topic though which data is ingested (not applicable for the Agent Metric Collector of the Collection Service)</li><li>Connection between the Kafka topic and the database table (not applicable for the Agent Metric Collector of the Collection Service)</li></ul><p></p><p class="MsoNormal">This information is defined in a well-known JSON file format and configured using the Content Administration Service.<br></p><h3>Collect and ingest</h3><h4>Collection Service</h4><p class="MsoNormal">For the reporting use case, the recommended method of Operations Agent metric collection is to use the Collection Service.&nbsp; The metrics to collect, the agents from which to collect and how frequently to collect are defined in a well-known JSON file format and configured using the Content Administration Service.</p><h4>OBM policies</h4><p class="MsoNormal">If you use OBM policies to post the data to COSO, then you need to create, assign and deploy the policies.&nbsp; The policies contain which metrics to collect from the local agent and how frequently to send the data to the COSO Data Lake. The Operations Agent, apart from acting as a source of system performance metrics, also acts as a metric integration framework, and provides the following options to integrate metrics to the COSO Data Lake.</p><p class="MsoNormal"><img src="https://docs.microfocus.com/mediawiki/images/PN/diag1.png"><br></p><div><br></div>